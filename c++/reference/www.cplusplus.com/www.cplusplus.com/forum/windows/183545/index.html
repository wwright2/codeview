<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Beginner: Win32 API NetUserAdd can't run - C++ Forum</title>
<link rel="shortcut icon" type="image/x-icon" href="/favicon.ico">
<link rel="stylesheet" type="text/css" href="/v321/main.css">
<script src="/v321/main.js" type="text/javascript"></script>
<script type='text/javascript'>
var googletag = googletag || {};
googletag.cmd = googletag.cmd || [];
(function() {
var gads = document.createElement('script');
gads.async = true;
gads.type = 'text/javascript';
var useSSL = 'https:' == document.location.protocol;
gads.src = (useSSL ? 'https:' : 'http:') + 
'//www.googletagservices.com/tag/js/gpt.js';
var node = document.getElementsByTagName('script')[0];
node.parentNode.insertBefore(gads, node);
})();
</script>

<script type='text/javascript'>
googletag.cmd.push(function() {
googletag.defineSlot('/32882001/L', [728, 90], 'div-gpt-ad-1427191279638-0').addService(googletag.pubads());
googletag.enableServices();
});
</script>
</head>
<body>
<div id="I_top">
<div id="I_header">
<div id="I_logo"><a href="/" title="cplusplus.com"><div></div></a></div>
<div id="I_search">
<form id="search" action="/search.do" method="get">
Search: <input name="q" size="20" class="txt"> <input type="submit" value="Go" class="btn">
</form>
</div>
<div id="I_bar">
<ul>
<li><a href="/forum/">Forum</a></li>
<li><a href="/forum/windows/">Windows Programming</a></li>
<li class="here">Beginner: Win32 API NetUserAdd can't run</li>
</ul>
</div>
<div id="I_user" class="C_LoginBox"><span title="ajax"></span></div>
</div>
</div>
<div id="I_mid">
<div id="I_wrap">
<div id="I_minheight"></div>
<div id="I_main">
<div class="C_support">
<div id='div-gpt-ad-1427191279638-0' style='width:728px; height:90px;'>
<script type='text/javascript'>
googletag.cmd.push(function() { googletag.display('div-gpt-ad-1427191279638-0'); });
</script>
</div>
</div>
<div id="I_content">
<h3><div class="C_ico solved" title="solved">&nbsp;</div> Beginner: Win32 API NetUserAdd can't run on Windows 10</h3><span id="CH_edttl"></span><span class="rootdatPost" title="183545,root,0,-1,5,0"></span><div id="CH_PostList"><div class="C_forPost" id="msg898306"><span title="898306,148267,1023,22,1"></span>
<div class="box">
<div class="boxtop">
<div class="dwhen"><a href="#msg898306" title="Link to this post"><img src="/img/link.png" width="16" height="8"></a> <span id="CH_zTm5e6fba9de1" title="Sat, 30 Jan 2016 01:54:36 +0000"></span><script type="text/javascript">WhenId('CH_zTm5e6fba9de1');</script><noscript>Jan 30, 2016 at 1:54am UTC</noscript></div>
<div class="dwho"><a href="/user/sail456852/"><b>sail456852</b> (22)</a></div>
</div>
<div class="dwhat" colspan="2" id="CH_i898306">
Here is my code which works on Windows 7 (Visual Studio 2013 Express installed )<br>
not on my Windows 10 （Visual Studio 2015 Community installed）<br>
<br>
#ifndef UNICODE<br>
#define UNICODE<br>
#endif<br>
#pragma comment(lib, "netapi32.lib")  //heard this is dynamic linking ? <br>
<br>
#include &lt;windows.h&gt; <br>
#include &lt;lm.h&gt;<br>
<br>
int main()<br>
{<br>
USER_INFO_1 ui;<br>
DWORD dwLevel = 1;<br>
DWORD dwError = 0;<br>
//NET_API_STATUS nStatus;<br>
<br>
ui.usri1_name = L"OMG";<br>
ui.usri1_password = L"Bitch@2015";<br>
ui.usri1_priv = USER_PRIV_USER;<br>
ui.usri1_home_dir = NULL;<br>
ui.usri1_comment = NULL;<br>
ui.usri1_flags = UF_PASSWD_CANT_CHANGE;<br>
ui.usri1_script_path = NULL;<br>
<br>
NetUserAdd(NULL,dwLevel,(LPBYTE)&amp;ui,&amp;dwError);<br>
<br>
}<br>
<br>
//Just call the NetUserAdd() function ! nothing else <br>
//It requires netapi32.dll to run ! and maybe netapi32.lib too <br>
<br>
//I know how to compile .lib against source.cpp to make a standalone program <br>
<br>
Here are my questions : <br>
<br>
1. Why can't the code work on another Windows 7 without Visual Studio installed ?(Even there is a netapi32.dll file in the system folder !)<br>
2. Why can't it run on Windows 10 ? <br>
3. Where to find the netapi32.lib file ? so I can use it to make a standalone program .(static linking )(it requires netapi32.dll to run , so I think it is still a dynamic linked program )<br>
<br>
Help please , I've been researching on this topic for so long .<br>
<br>
I read other people's post , my problem solved ,anyone encounters this problem ,can refer to<br>
this link : <a href="http://www.cplusplus.com/forum/windows/182467/">http://www.cplusplus.com/forum/windows/182467/</a> <br>
Good luck everyone !
</div>
<div class="dhow">
<span class="sedited">Last edited on <span id="CH_zTmace88a38de" title="Tue, 02 Feb 2016 01:38:54 +0000"></span><script type="text/javascript">WhenId('CH_zTmace88a38de');</script><noscript>Feb 2, 2016 at 1:38am UTC</noscript></span>
<span class="dbtn" id="CH_btn898306"></span>

</div>
</div>
</div>
<div class="C_forPost" id="msg898414"><span title="898414,140309,1023,149,0"></span>
<div class="box">
<div class="boxtop">
<div class="dwhen"><a href="#msg898414" title="Link to this post"><img src="/img/link.png" width="16" height="8"></a> <span id="CH_zTm5749083959" title="Sat, 30 Jan 2016 17:01:38 +0000"></span><script type="text/javascript">WhenId('CH_zTm5749083959');</script><noscript>Jan 30, 2016 at 5:01pm UTC</noscript></div>
<div class="dwho"><a href="/user/Shadowwolf/"><b>Shadowwolf</b> (149)</a></div>
</div>
<div class="dwhat" colspan="2" id="CH_i898414">
The netapi32.lib is an import library. The compiler uses this to link your program against the dynamic library netapi32.dll. You do not need the netapi32.lib file on the other machines to be able to run the code there, only to compile it. In fact, all you need is netapi32.dll, which should be on all windows systems by default. If you are missing the dll, you will get an error dialog saying netapi32.dll was not found on the system.<br>
<br>
I think the problem is more of a privilege problem. You probably execute the code as administrator on your own computer, but as a regular user on the other computers. Adding a user requires administrator privileges, so you could try running it as administrator to solve the problem.<br>
<br>
Try printing the result of NetUserAdd, these give a good indication as to what problem is going on. Take a look at <a href="https://msdn.microsoft.com/en-us/library/windows/desktop/aa370649%28v=vs.85%29.aspx">https://msdn.microsoft.com/en-us/library/windows/desktop/aa370649%28v=vs.85%29.aspx</a> in the result value section for more information on what this function might return and when.
</div>
<div class="dhow">
<span class="dbtn" id="CH_btn898414"></span>

</div>
</div>
</div>
<div class="C_forPost" id="msg898909"><span title="898909,148267,1023,22,0"></span>
<div class="box">
<div class="boxtop">
<div class="dwhen"><a href="#msg898909" title="Link to this post"><img src="/img/link.png" width="16" height="8"></a> <span id="CH_zTm27406f5303" title="Tue, 02 Feb 2016 01:30:32 +0000"></span><script type="text/javascript">WhenId('CH_zTm27406f5303');</script><noscript>Feb 2, 2016 at 1:30am UTC</noscript></div>
<div class="dwho"><a href="/user/sail456852/"><b>sail456852</b> (22)</a></div>
</div>
<div class="dwhat" colspan="2" id="CH_i898909">
Thanks ,It's true that I didn't notice privilege problem .<br>
With Administrator privilege ,I now can run the statically linked program as planned,created a user successfully ! . <br>
but the dynamically linked program ,which this time it didn't complain <br>
   missing netapi32.dll!(OS does have this dll !) ,instead , it complains  <br>
  <b> missing VCRUNTIME140.dll </b>! ,  Following is what I found about VCRUMTIME140.dll :<br>
  It belongs to Visual C++ Redistributable  Packages for Visual Studio <br>
   is one of Visual C++ Runtime Files  <br>
<br>
Question: Why did it happen ? <br>
(NetUserAdd() MSDN page says it only requires netapi32.dll .....)<br>
 
</div>
<div class="dhow">
<span class="dbtn" id="CH_btn898909"></span>

</div>
</div>
</div>
<div class="C_forPost" id="msg899069"><span title="899069,140309,1023,149,0"></span>
<div class="box">
<div class="boxtop">
<div class="dwhen"><a href="#msg899069" title="Link to this post"><img src="/img/link.png" width="16" height="8"></a> <span id="CH_zTmb102251cc8" title="Tue, 02 Feb 2016 16:52:49 +0000"></span><script type="text/javascript">WhenId('CH_zTmb102251cc8');</script><noscript>Feb 2, 2016 at 4:52pm UTC</noscript></div>
<div class="dwho"><a href="/user/Shadowwolf/"><b>Shadowwolf</b> (149)</a></div>
</div>
<div class="dwhat" colspan="2" id="CH_i899069">
This is the runtime required to run applications compiler with the Visual C++ compiler. These files are usually already on the computers running the applications (the installer might take care of installing these files), but since you just copied the files over, you have to manually make sure the files are available. Most of the time, this file will be there already, but I guess you are unlucky in this game (probably due to the fact that no applications have ever required this runtime before on the target computer). You can always download the runtime from here:<br>
<br>
For visual studio 2015:<br>
<a href="https://www.microsoft.com/en-us/download/details.aspx?id=48145">https://www.microsoft.com/en-us/download/details.aspx?id=48145</a><br>
For visual studio 2013:<br>
<a href="https://www.microsoft.com/en-us/download/details.aspx?id=40784">https://www.microsoft.com/en-us/download/details.aspx?id=40784</a><br>
<br>
Note, you must install the file corresponding to the visual C++ version you compiled your code with.<br>
<br>
Note that all applications using Visual C++ require this runtime, so this problem is not related to NetUserAdd(). This problem will occur on all executables.
</div>
<div class="dhow">
<span class="sedited">Last edited on <span id="CH_zTm5ed9a88dce" title="Tue, 02 Feb 2016 16:53:41 +0000"></span><script type="text/javascript">WhenId('CH_zTm5ed9a88dce');</script><noscript>Feb 2, 2016 at 4:53pm UTC</noscript></span>
<span class="dbtn" id="CH_btn899069"></span>

</div>
</div>
</div>
<div class="C_forPost" id="msg901208"><span title="901208,211606,255,1,0"></span>
<div class="box">
<div class="boxtop">
<div class="dwhen"><a href="#msg901208" title="Link to this post"><img src="/img/link.png" width="16" height="8"></a> <span id="CH_zTme980be8dce" title="Wed, 10 Feb 2016 16:32:53 +0000"></span><script type="text/javascript">WhenId('CH_zTme980be8dce');</script><noscript>Feb 10, 2016 at 4:32pm UTC</noscript></div>
<div class="dwho"><a href="/user/cvanbrederode/"><b>cvanbrederode</b> (1)</a></div>
</div>
<div class="dwhat" colspan="2" id="CH_i901208">
It is possible to statically link to the C Runtime Libraries...the option is in the project properties.<br>
<br>
Under the configuration Properties, in the C/C++ tab, open the Code Generation dialog.  You'll see an option for "Runtime Library".  You can select from some combination of three choices: Debug or Release, Multithreaded or Singlethreaded, Static or DLL.  The default is Multithreaded DLL, with Debug or Release depending on if you're compiling as Debug or Release.  Just change ti to Multithreaded (without the "DLL") to statically link to the runtime.<br>
<br>
You'll have to change this for each configuration; usually there are two, Release and Debug.<br>
<br>
And keep in mind this will make your exe larger, since code that is normally called from a DLL has to be included in the file.<br>
<br>
Note that this applies to *any* C/C++ program built with visual studio.
</div>
<div class="dhow">
<span class="dbtn" id="CH_btn901208"></span>

</div>
</div>
</div>
</div><div class="rootinsMore"></div><div class="rootbtnMore"></div><div class="rootinsNew"></div><div class="rootbtnNew"></div><div id="CH_insNew"></div><div id="CH_reply">Registered users can post here. <a href="/user/">Sign in or register</a> to post.</div><div id="CH_subscription"></div><div class="rootedtNew"></div><script type="text/javascript">new for_PostList(183545,0,148267,1,'CH_PostList','CH_subscription','CH_reply','CH_insNew','CH_edttl','/forum/thread.cgi','/forum/post.cgi','/forum/myposts.cgi',64,32,512,256,1024,16);</script></div>
<script type="text/javascript">
    google_ad_client = "ca-pub-1444228343479937";
    google_ad_slot = "9701143201";
    google_ad_width = 728;
    google_ad_height = 90;
</script>
<!-- leaderboard -->
<script type="text/javascript"
src="//pagead2.googlesyndication.com/pagead/show_ads.js">
</script></div>
<div id="I_nav">
<div class="sect root">
<h3><b><a href="/">C++</a></b></h3>
<ul>
<li class="folder info"><a href="/info/">Information</a></li>
<li class="folder doc"><a href="/doc/">Tutorials</a></li>
<li class="folder reference"><a href="/reference/">Reference</a></li>
<li class="folder articles"><a href="/articles/">Articles</a></li>
<li class="folder selected forum"><a href="/forum/">Forum</a></li>
</ul>
</div>
<div class="sect">
<h3><b><a href="/forum/">Forum</a></b></h3>
<ul>
<li><a href="/forum/beginner/"><b>Beginners</b></a></li><li class="selected"><a href="/forum/windows/"><b>Windows Programming</b></a></li><li><a href="/forum/unices/"><b>UNIX/Linux Programming</b></a></li><li><a href="/forum/general/"><b>General C++ Programming</b></a></li><li><a href="/forum/lounge/"><b>Lounge</b></a></li><li><a href="/forum/jobs/"><b>Jobs</b></a></li></ul>
</div>
<div id="I_subnav"></div>
<div class="C_ad234">
<script type="text/javascript"><!--
google_ad_client = "ca-pub-7688470879129516";
google_ad_slot = "7445514729";
google_ad_width = 234;
google_ad_height = 60;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</div></div>
<div id="I_midclear"></div>
</div>
</div>
<div id="I_bottom">
<div id="I_footer">
	<a href="/">Home page</a> | <a href="/privacy.do">Privacy policy</a><br>&copy; cplusplus.com, 2000-2016 - All rights reserved - <i>v3.1</i><br><a href="/contact.do?referrer=www.cplusplus.com%2Fforum%2Fwindows%2F183545%2F">Spotted an error? contact us</a>
</div>
</div>

<script type="text/javascript">
<!--
function NavFor(us) {document.getElementById('I_subnav').innerHTML=us.ok?'<div class="sect"><h3><b><a href="/user/">'+us.user+'</a></b></h3><ul><li><a href="/forum/myposts.cgi">My topics</a></li></ul></div>':'';}onSession(NavFor);ready();
var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-521783-1']);
_gaq.push(['_trackPageview']);

(function() {
  var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
  ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
  var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();

//-->
</script>

</body>
</html>