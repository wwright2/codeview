<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>typedef and function pointers (with inst - C++ Forum</title>
<link rel="shortcut icon" type="image/x-icon" href="/favicon.ico">
<link rel="stylesheet" type="text/css" href="/v321/main.css">
<script src="/v321/main.js" type="text/javascript"></script>
<script type='text/javascript'>
var googletag = googletag || {};
googletag.cmd = googletag.cmd || [];
(function() {
var gads = document.createElement('script');
gads.async = true;
gads.type = 'text/javascript';
var useSSL = 'https:' == document.location.protocol;
gads.src = (useSSL ? 'https:' : 'http:') + 
'//www.googletagservices.com/tag/js/gpt.js';
var node = document.getElementsByTagName('script')[0];
node.parentNode.insertBefore(gads, node);
})();
</script>

<script type='text/javascript'>
googletag.cmd.push(function() {
googletag.defineSlot('/32882001/L', [728, 90], 'div-gpt-ad-1427191279638-0').addService(googletag.pubads());
googletag.enableServices();
});
</script>
</head>
<body>
<div id="I_top">
<div id="I_header">
<div id="I_logo"><a href="/" title="cplusplus.com"><div></div></a></div>
<div id="I_search">
<form id="search" action="/search.do" method="get">
Search: <input name="q" size="20" class="txt"> <input type="submit" value="Go" class="btn">
</form>
</div>
<div id="I_bar">
<ul>
<li><a href="/forum/">Forum</a></li>
<li><a href="/forum/windows/">Windows Programming</a></li>
<li class="here">typedef and function pointers (with inst</li>
</ul>
</div>
<div id="I_user" class="C_LoginBox"><span title="ajax"></span></div>
</div>
</div>
<div id="I_mid">
<div id="I_wrap">
<div id="I_minheight"></div>
<div id="I_main">
<div class="C_support">
<div id='div-gpt-ad-1427191279638-0' style='width:728px; height:90px;'>
<script type='text/javascript'>
googletag.cmd.push(function() { googletag.display('div-gpt-ad-1427191279638-0'); });
</script>
</div>
</div>
<div id="I_content">
<h3><div class="C_ico solved" title="solved">&nbsp;</div> typedef and function pointers (with instances)</h3><span id="CH_edttl"></span><span class="rootdatPost" title="181497,root,0,-1,4,0"></span><div id="CH_PostList"><div class="C_forPost" id="msg890338"><span title="890338,143434,1023,19,1"></span>
<div class="box">
<div class="boxtop">
<div class="dwhen"><a href="#msg890338" title="Link to this post"><img src="/img/link.png" width="16" height="8"></a> <span id="CH_zTmac4c52cf60" title="Sun, 20 Dec 2015 05:03:04 +0000"></span><script type="text/javascript">WhenId('CH_zTmac4c52cf60');</script><noscript>Dec 20, 2015 at 5:03am UTC</noscript></div>
<div class="dwho"><a href="/user/ChemicalBliss/"><b>ChemicalBliss</b> (19)</a></div>
</div>
<div class="dwhat" colspan="2" id="CH_i890338">
Ok this should be pretty straight-forward imo but for some reason I can't get anything I try to work.<br>
<br>
Can someone explain why this code will not compile or another way of doing this function pointer callback thing.<br>
<br>
My goal is to send this function pointer with some request data to another thread. Once the thread has finished with the data it sends that data to the function presented from the function pointer. The pointer should point to the instance method (there is only ever 1 instance).<br>
<br>
Just trying to use standard c++11. (and learn ofc).<br>
<br>
The example is barebones but produces my problem.<br>
<br>
Main.cpp<br>
<div class="auto"><table class="snippet"><tr><td class="rownum"><pre><code>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br></code></pre></td>
<td class="source"><pre><code><dfn>#include "stdafx.h"</dfn>
<dfn>#include&lt;iostream&gt;</dfn>
<dfn>#include"ClassA.h"</dfn>


<var>int</var> main()
{
	ClassA *classa = <var>new</var> ClassA();
	classa-&gt;invokeCallback(&amp;classa-&gt;callbackFunc, <kbd>"some initial data"</kbd>);

	std::cin.get();
    <var>return</var> 0;
}
</code></pre></td><td class="C_btnholder"></td></tr></table></div>
<br>
<br>
ClassA.h<br>
<div class="auto"><table class="snippet"><tr><td class="rownum"><pre><code>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br></code></pre></td>
<td class="source"><pre><code><dfn>#pragma once</dfn>
<dfn>#include&lt;map&gt;</dfn>
<dfn>#include&lt;string&gt;</dfn>

<var>typedef</var> <var>void</var>(*tFunc)(std::string); <cite>// function pointer type</cite>

<var>typedef</var> std::map&lt;tFunc*, std::string&gt; tFuncMap; <cite>// need tFunc typedef for map typedef</cite>

<var>class</var> ClassA
{
	<var>public</var>:
		<var>void</var> callbackFunc(std::string data); <cite>// Callback func</cite>
		<var>void</var> invokeCallback(tFunc t, std::string data);
};
</code></pre></td><td class="C_btnholder"></td></tr></table></div>
<br>
<br>
ClassA.cpp<br>
<div class="auto"><table class="snippet"><tr><td class="rownum"><pre><code>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br></code></pre></td>
<td class="source"><pre><code><dfn>#include "stdafx.h"</dfn>
<dfn>#include "ClassA.h"</dfn>
<dfn>#include&lt;iostream&gt;</dfn>

<var>void</var> ClassA::callbackFunc(std::string data)
{
	<cite>// do some stuff</cite>
	std::cout &lt;&lt; <kbd>"Did some stuff with: "</kbd> + data;
};

<var>void</var> invokeCallback(tFunc t, std::string data)
{
	t(data);
};</code></pre></td><td class="C_btnholder"></td></tr></table></div>
<br>
<br>
<span class="auto"><code class="source">classa-&gt;invokeCallback(&amp;classa-&gt;callbackFunc, <kbd>"some initial data"</kbd>);</code></span><br>
This is the trouble... Can't seem to use instances and using the static decleration the types mis-match? Because it's in the class scope maybe? but how fix :(<br>
<br>
Thanks for any advice. Just want to learn really, how i can use callback functions in this way.<br>
<br>
Also any more efficient alternatives for my idea would be helpful.<br>
<br>
(Idea is to have a seperate thread with a queue system, the main thread will add to queue even if other thread is working on another queue item. Main thread would retrieve results in a map type array with tickets to match request with result data).<br>
<br>
Thanks!<br>
<b>--------------</b><br>
<br>
<u><b>EDIT:</b></u><br>
So I have worked out how to do this while passing an instance pointer separately like so,<br>
<br>
Main<br>
<div class="auto"><table class="snippet"><tr><td class="rownum"><pre><code>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br></code></pre></td>
<td class="source"><pre><code><dfn>#include "stdafx.h"</dfn>
<dfn>#include&lt;iostream&gt;</dfn>
<dfn>#include"ClassA.h"</dfn>


<var>int</var> main()
{
	ClassA *classa = <var>new</var> ClassA();
	classa-&gt;invokeCallback(classa, &amp; ClassA::callbackFunc, <kbd>"some initial data"</kbd>);

	std::cin.get();
    <var>return</var> 0;
}</code></pre></td><td class="C_btnholder"></td></tr></table></div>
<br>
<br>
ClassA Header<br>
<div class="auto"><table class="snippet"><tr><td class="rownum"><pre><code>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br></code></pre></td>
<td class="source"><pre><code><dfn>#pragma once</dfn>
<dfn>#include&lt;map&gt;</dfn>
<dfn>#include&lt;string&gt;</dfn>

<var>class</var> ClassA
{
	<var>public</var>:
		<var>typedef</var> <var>void</var>(ClassA::*tFunc)(std::string); <cite>// function pointer type</cite>

		<var>void</var> callbackFunc(std::string data); <cite>// Callback func</cite>
		<var>void</var> invokeCallback(ClassA*c, tFunc t, std::string data);
};
</code></pre></td><td class="C_btnholder"></td></tr></table></div>
<br>
<br>
Class A<br>
<div class="auto"><table class="snippet"><tr><td class="rownum"><pre><code>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br></code></pre></td>
<td class="source"><pre><code><dfn>#include "stdafx.h"</dfn>
<dfn>#include "ClassA.h"</dfn>
<dfn>#include&lt;iostream&gt;</dfn>

<var>void</var> ClassA::callbackFunc(std::string data)
{
	<cite>// do some stuff</cite>
	std::cout &lt;&lt; <kbd>"Did some stuff with: "</kbd> + data;
}
<var>void</var> ClassA::invokeCallback(ClassA*c, tFunc t, std::string data)
{
	(c-&gt;*(t))(data);
};</code></pre></td><td class="C_btnholder"></td></tr></table></div>
<br>
<br>
Now the question is, how can I pass a direct pointer to the instanced method? Rather than passing the static pointer, can't i add the static method pointer to the instance pointer? how would that work gracefully?<br>
<br>
Maybe related but also, how could i make a generic reference to a pointer type rather than specifying the class pointer? <span class="auto"><code class="source">(ClassA*c)</code></span><br>
<br>
Thanks!
</div>
<div class="dhow">
<span class="sedited">Last edited on <span id="CH_zTma520b10822" title="Sun, 20 Dec 2015 06:15:35 +0000"></span><script type="text/javascript">WhenId('CH_zTma520b10822');</script><noscript>Dec 20, 2015 at 6:15am UTC</noscript></span>
<span class="dbtn" id="CH_btn890338"></span>

</div>
</div>
</div>
<div class="C_forPost" id="msg890563"><span title="890563,39415,1023,5467,0"></span>
<div class="box">
<div class="boxtop">
<div class="dwhen"><a href="#msg890563" title="Link to this post"><img src="/img/link.png" width="16" height="8"></a> <span id="CH_zTmc421c3a552" title="Mon, 21 Dec 2015 10:31:04 +0000"></span><script type="text/javascript">WhenId('CH_zTmc421c3a552');</script><noscript>Dec 21, 2015 at 10:31am UTC</noscript></div>
<div class="dwho"><a href="/user/coder777/"><b>coder777</b> (5467)</a></div>
</div>
<div class="dwhat" colspan="2" id="CH_i890563">
You may pass a function object:<br>
<br>
<a href="http://www.cplusplus.com/reference/functional/">http://www.cplusplus.com/reference/functional/</a><br>
<br>
Using bind() you can pass a member function as well as a free function.
</div>
<div class="dhow">
<span class="dbtn" id="CH_btn890563"></span>

</div>
</div>
</div>
<div class="C_forPost" id="msg890740"><span title="890740,143434,1023,19,0"></span>
<div class="box">
<div class="boxtop">
<div class="dwhen"><a href="#msg890740" title="Link to this post"><img src="/img/link.png" width="16" height="8"></a> <span id="CH_zTm0645de1b51" title="Tue, 22 Dec 2015 05:41:17 +0000"></span><script type="text/javascript">WhenId('CH_zTm0645de1b51');</script><noscript>Dec 22, 2015 at 5:41am UTC</noscript></div>
<div class="dwho"><a href="/user/ChemicalBliss/"><b>ChemicalBliss</b> (19)</a></div>
</div>
<div class="dwhat" colspan="2" id="CH_i890740">
Thanks! Not quite what I want for my application but never the less it gave me an idea and I'm now making good progress on the concept :). And ofc now I know about functional objects :).
</div>
<div class="dhow">
<span class="dbtn" id="CH_btn890740"></span>

</div>
</div>
</div>
<div class="C_forPost" id="msg890820"><span title="890820,78419,1023,7174,0"></span>
<div class="box">
<div class="boxtop">
<div class="dwhen"><a href="#msg890820" title="Link to this post"><img src="/img/link.png" width="16" height="8"></a> <span id="CH_zTm6eaf5cf4af" title="Tue, 22 Dec 2015 14:53:52 +0000"></span><script type="text/javascript">WhenId('CH_zTm6eaf5cf4af');</script><noscript>Dec 22, 2015 at 2:53pm UTC</noscript></div>
<div class="dwho"><a href="/user/cire/"><b>cire</b> (7174)</a></div>
</div>
<div class="dwhat" colspan="2" id="CH_i890820">
<table class="quote"><tr><td class="qd">Maybe related but also, how could i make a generic reference to a pointer type rather than specifying the class pointer? (ClassA*c)</td></tr></table><br>
<br>
Since you're using a class method to invoke the callback function, I don't see why you're passing a pointer to an instance at all:<br>
<br>
<div class="auto"><table class="snippet"><tr><td class="rownum"><pre><code>1<br>2<br>3<br>4<br></code></pre></td>
<td class="source"><pre><code><var>void</var> ClassA::invokeCallback(tFunc t, std::string data)
{
	(<var>this</var>-&gt;*(t))(data);
}</code></pre></td><td class="C_btnholder"></td></tr></table></div>

</div>
<div class="dhow">
<span class="sedited">Last edited on <span id="CH_zTm6eedfd9d1e" title="Tue, 22 Dec 2015 14:54:36 +0000"></span><script type="text/javascript">WhenId('CH_zTm6eedfd9d1e');</script><noscript>Dec 22, 2015 at 2:54pm UTC</noscript></span>
<span class="dbtn" id="CH_btn890820"></span>

</div>
</div>
</div>
</div><div class="rootinsMore"></div><div class="rootbtnMore"></div><div class="rootinsNew"></div><div class="rootbtnNew"></div><div id="CH_insNew"></div><div id="CH_reply">Topic archived. No new replies allowed.</div><div id="CH_subscription"></div><div class="rootedtNew"></div><script type="text/javascript">new for_PostList(181497,1,143434,1,'CH_PostList','CH_subscription','CH_reply','CH_insNew','CH_edttl','/forum/thread.cgi','/forum/post.cgi','/forum/myposts.cgi',64,32,512,256,1024,16);</script></div>
<script type="text/javascript">
    google_ad_client = "ca-pub-1444228343479937";
    google_ad_slot = "9701143201";
    google_ad_width = 728;
    google_ad_height = 90;
</script>
<!-- leaderboard -->
<script type="text/javascript"
src="//pagead2.googlesyndication.com/pagead/show_ads.js">
</script></div>
<div id="I_nav">
<div class="sect root">
<h3><b><a href="/">C++</a></b></h3>
<ul>
<li class="folder info"><a href="/info/">Information</a></li>
<li class="folder doc"><a href="/doc/">Tutorials</a></li>
<li class="folder reference"><a href="/reference/">Reference</a></li>
<li class="folder articles"><a href="/articles/">Articles</a></li>
<li class="folder selected forum"><a href="/forum/">Forum</a></li>
</ul>
</div>
<div class="sect">
<h3><b><a href="/forum/">Forum</a></b></h3>
<ul>
<li><a href="/forum/beginner/"><b>Beginners</b></a></li><li class="selected"><a href="/forum/windows/"><b>Windows Programming</b></a></li><li><a href="/forum/unices/"><b>UNIX/Linux Programming</b></a></li><li><a href="/forum/general/"><b>General C++ Programming</b></a></li><li><a href="/forum/lounge/"><b>Lounge</b></a></li><li><a href="/forum/jobs/"><b>Jobs</b></a></li></ul>
</div>
<div id="I_subnav"></div>
<div class="C_ad234">
<script type="text/javascript"><!--
google_ad_client = "ca-pub-7688470879129516";
google_ad_slot = "7445514729";
google_ad_width = 234;
google_ad_height = 60;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</div></div>
<div id="I_midclear"></div>
</div>
</div>
<div id="I_bottom">
<div id="I_footer">
	<a href="/">Home page</a> | <a href="/privacy.do">Privacy policy</a><br>&copy; cplusplus.com, 2000-2016 - All rights reserved - <i>v3.1</i><br><a href="/contact.do?referrer=www.cplusplus.com%2Fforum%2Fwindows%2F181497%2F">Spotted an error? contact us</a>
</div>
</div>

<script type="text/javascript">
<!--
function NavFor(us) {document.getElementById('I_subnav').innerHTML=us.ok?'<div class="sect"><h3><b><a href="/user/">'+us.user+'</a></b></h3><ul><li><a href="/forum/myposts.cgi">My topics</a></li></ul></div>':'';}onSession(NavFor);ready();
var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-521783-1']);
_gaq.push(['_trackPageview']);

(function() {
  var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
  ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
  var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();

//-->
</script>

</body>
</html>