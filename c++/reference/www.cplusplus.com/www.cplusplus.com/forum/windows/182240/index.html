<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>localhost performance question - C++ Forum</title>
<link rel="shortcut icon" type="image/x-icon" href="/favicon.ico">
<link rel="stylesheet" type="text/css" href="/v321/main.css">
<script src="/v321/main.js" type="text/javascript"></script>
<script type='text/javascript'>
var googletag = googletag || {};
googletag.cmd = googletag.cmd || [];
(function() {
var gads = document.createElement('script');
gads.async = true;
gads.type = 'text/javascript';
var useSSL = 'https:' == document.location.protocol;
gads.src = (useSSL ? 'https:' : 'http:') + 
'//www.googletagservices.com/tag/js/gpt.js';
var node = document.getElementsByTagName('script')[0];
node.parentNode.insertBefore(gads, node);
})();
</script>

<script type='text/javascript'>
googletag.cmd.push(function() {
googletag.defineSlot('/32882001/L', [728, 90], 'div-gpt-ad-1427191279638-0').addService(googletag.pubads());
googletag.enableServices();
});
</script>
</head>
<body>
<div id="I_top">
<div id="I_header">
<div id="I_logo"><a href="/" title="cplusplus.com"><div></div></a></div>
<div id="I_search">
<form id="search" action="/search.do" method="get">
Search: <input name="q" size="20" class="txt"> <input type="submit" value="Go" class="btn">
</form>
</div>
<div id="I_bar">
<ul>
<li><a href="/forum/">Forum</a></li>
<li><a href="/forum/windows/">Windows Programming</a></li>
<li class="here">localhost performance question</li>
</ul>
</div>
<div id="I_user" class="C_LoginBox"><span title="ajax"></span></div>
</div>
</div>
<div id="I_mid">
<div id="I_wrap">
<div id="I_minheight"></div>
<div id="I_main">
<div class="C_support">
<div id='div-gpt-ad-1427191279638-0' style='width:728px; height:90px;'>
<script type='text/javascript'>
googletag.cmd.push(function() { googletag.display('div-gpt-ad-1427191279638-0'); });
</script>
</div>
</div>
<div id="I_content">
<h3><div class="C_ico default" title="post">&nbsp;</div> localhost performance question</h3><span id="CH_edttl"></span><span class="rootdatPost" title="182240,root,0,-1,2,0"></span><div id="CH_PostList"><div class="C_forPost" id="msg893171"><span title="893171,206125,255,2,1"></span>
<div class="box">
<div class="boxtop">
<div class="dwhen"><a href="#msg893171" title="Link to this post"><img src="/img/link.png" width="16" height="8"></a> <span id="CH_zTm528fc88803" title="Tue, 05 Jan 2016 22:45:58 +0000"></span><script type="text/javascript">WhenId('CH_zTm528fc88803');</script><noscript>Jan 5, 2016 at 10:45pm UTC</noscript></div>
<div class="dwho"><a href="/user/voidstar/"><b>voidstar</b> (2)</a></div>
</div>
<div class="dwhat" colspan="2" id="CH_i893171">
I wrote my own network TCP/IP send/receive benchmark utility, and I have results similar/consistent with iperf.   One reason I wrote my own was to try to better understand why localhost performance is so much slower than RAM (especially given that localhost isn't even suppose to touch the NIC -- you can disable ALL your network adapters, and still ping and send TCP over 127.0.0.1).  I've assume localhost is implemented by the host OS (Windows 10 Pro 64-bit in this case) and NOT the NIC drivers or motherboard drivers (where I noticed localhost has a MTU of 4GB, but otherwise I'm not sure what size send/receive buffers are allocated to localhost).<br>
<br>
I am seeing localhost performance of about 4000-8000 Mbps (or about 600-900 MBps) on i7-DDR3 based hardware (stuff under 2 years old), and memtest86+ is showing RAM speeds much faster than this (say 20k-40k Mbps).  I assume the difference is due to TCP/IP packaging overhead (though localhost MTU is 4GB, I assume the host OS still has to partition data in packets).  Note, I am using boost 1.60 and VS2015 Community (boost was also compiled with my VS2015) for the io service library.<br>
<br>
My main real question is this: I have 12 different systems that I've tested this benchmark on (various laptops and desktops).  I have a particular system that is consistently getting HALF the network I/O performance across localhost than my other systems.  I HAVE tested with some older/slower 2007-2009 era DDR2-based systems, and indeed CPU/memory performance does effect the benchmark throughput (as expected!).  But my original question stands because the unexpected performance is on a fairly modern system.  So I suspect my question is more of a motherboard/chipset architecture question.  Here are the details:<br>
<br>
SYSTEM A: (named OANH, average result is 880/940 MBps send/recv performance)<br>
OS Win10 64-bit, 16GB DDR3, i7-4770/3.4GHz CPU, ASUS B85M-E/CSM mainboard<br>
mainboard link:  <a href="http://www.asus.com/Motherboards/B85ME/">http://www.asus.com/Motherboards/B85ME/</a><br>
<br>
SYSTEM B: (named BLACKJACK, average result is 334/342 MBps send/recv performance)<br>
OS Win10 64-bit, 16GB DDR3, i7-3770K/3.5GHz CPU, MSI Z77A-G45 mainboard<br>
mainboard link:  <a href="http://us.msi.com/product/motherboard/Z77AG45.html#hero-overview">http://us.msi.com/product/motherboard/Z77AG45.html#hero-overview</a><br>
<br>
These results are with both 125MB and 1024MB/1GB payloads.  And again, I got similar results with iperf3 64-bit.  I have several other i5/i7 DDR3-based systems that get similar performance as SYSTEM A/OANH.   So that's my question -- memtest shows SYSTEM B/BLACKJACK has similar DDR3 main memory performance as all the other DDR3 machines.  And they are using the same OS (Win10 64-bit).  Architecturally, what could be causing localhost/127.0.0.1 traffic to be so much slower (almost half) on SYSTEM B?   Does sending across localhost (under win10) involve the north or south bridge, or is any part of the bus involved?<br>
<br>
While this is not a specific C++ question, eventually I would like to share my C++/boost implementation of a network benchmark.  But I'm hoping to come across someone with insight on localhost implementation under Windows.   I suppose in addition I should try to run this under Linux.  But again, all my other Win10 64-bit systems are getting over 600MBps send/receive performance -- it's just this one machine that is getting the 300MBps half-performance, and I haven't yet really come up with a rationale on why.  
</div>
<div class="dhow">
<span class="sedited">Last edited on <span id="CH_zTm45603d1c89" title="Wed, 06 Jan 2016 14:52:14 +0000"></span><script type="text/javascript">WhenId('CH_zTm45603d1c89');</script><noscript>Jan 6, 2016 at 2:52pm UTC</noscript></span>
<span class="dbtn" id="CH_btn893171"></span>

</div>
</div>
</div>
<div class="C_forPost" id="msg893268"><span title="893268,206125,255,2,0"></span>
<div class="box">
<div class="boxtop">
<div class="dwhen"><a href="#msg893268" title="Link to this post"><img src="/img/link.png" width="16" height="8"></a> <span id="CH_zTm9b3dedc2b1" title="Wed, 06 Jan 2016 12:57:51 +0000"></span><script type="text/javascript">WhenId('CH_zTm9b3dedc2b1');</script><noscript>Jan 6, 2016 at 12:57pm UTC</noscript></div>
<div class="dwho"><a href="/user/voidstar/"><b>voidstar</b> (2)</a></div>
</div>
<div class="dwhat" colspan="2" id="CH_i893268">
note, for iperf3 I used...<br>
<br>
server:  iperf3 -p 2228 -s<br>
client:  iperf3 -p 2228 -c 127.0.0.0.1 -n 131072000 -f M<br>
<br>
<br>
I use 131072000 since that is 125MB, which across an actual LAN Ethernet connection should take only 1 second to transfer (with gigabit components, as 1000Mbps = 125MBps).    Across localhost, you'd expect the 125MB to transfer much faster than 1 second (so at 300MBps, that's pretty fast -- but with same OS and similar h/w, I'd expect the 600-900MBps performance that the other configurations are getting).    I can change -n to 1024*1024*1024 (1GB) and the MBps throughput should be the same (which it is).<br>
<br>
edit: also to clarify the averages reflect over 1000 iterations/runs, and with Windows configured the same across the machines (e.g. Windows Search disabled, all applications closed, etc) -- too the extent possible, e.g. there are variations of video drivers and motherboard drivers.<br>
<br>
<br>
edit: here are iperf3 results and my ANT benchmark results for comparison (on SYSTEM B).  Note I match the ~320MBps result, though my benchmark also shows main memory performance of ~3200MBps (which is one of my main questions: why is localhost TCP/IP performance so much slower than main memory performance?)<br>
<br>
F:\iperf-3.0.11-win64&gt;iperf3 -p 2228 -c 127.0.0.1 -n 1073741824 -f M<br>
Connecting to host 127.0.0.1, port 2228<br>
[  4] local 127.0.0.1 port 56410 connected to 127.0.0.1 port 2228<br>
[ ID] Interval           Transfer     Bandwidth<br>
[  4]   0.00-1.00   sec   314 MBytes   314 MBytes/sec<br>
[  4]   1.00-2.00   sec   321 MBytes   321 MBytes/sec<br>
[  4]   2.00-3.00   sec   329 MBytes   329 MBytes/sec<br>
[  4]   3.00-3.18   sec  60.0 MBytes   327 MBytes/sec<br>
- - - - - - - - - - - - - - - - - - - - - - - - -<br>
[ ID] Interval           Transfer     Bandwidth<br>
[  4]   0.00-3.18   sec  1.00 GBytes   322 MBytes/sec                  sender<br>
[  4]   0.00-3.18   sec  1.00 GBytes   322 MBytes/sec                  receiver<br>
<br>
iperf Done.<br>
<br>
<br>
F:\ANT_0_1_0&gt;ant_64 -b 1073741824<br>
A Network (Performance) Tester v0.1.0<br>
Initializing program options...<br>
Logging data transfer content to file..: DISABLED<br>
Status tempo...........................: 21 (OFF)<br>
Working Buffer size....................: 65536 bytes<br>
Execution mode.........................: CLIENT (requests data from an ANT Server)<br>
Statistical history depth..............: 8<br>
Attempting to resolve host [127.0.0.1:2228]<br>
Host resolved to [127.0.0.1:2228]<br>
Issuing command as a client named [BLACKJACK]<br>
This client will be requesting [1073741824 bytes] repeated [20 times]<br>
Performance result summary will be written to [results_BLACKJACK.txt]<br>
ANT Test Command has been sent (33/33 bytes)<br>
(000001/000020) [memory=3,405.792  SEND=000,344.265  RECV=000,312.626 MBps]  [SEND=000,002.974449  RECV=000,003.275478 sec]<br>
(000002/000020) [memory=3,314.526  SEND=000,332.801  RECV=000,319.411 MBps]  [SEND=000,003.076912  RECV=000,003.205898 sec]<br>
(000003/000020) [memory=3,330.506  SEND=000,326.892  RECV=000,320.404 MBps]  [SEND=000,003.132535  RECV=000,003.195965 sec]<br>
(000004/000020) [memory=3,335.661  SEND=000,326.325  RECV=000,322.805 MBps]  [SEND=000,003.137973  RECV=000,003.172197 sec]<br>
(000005/000020) [memory=3,339.928  SEND=000,326.043  RECV=000,324.354 MBps]  [SEND=000,003.140693  RECV=000,003.157040 sec]<br>
(000006/000020) [memory=3,345.167  SEND=000,325.893  RECV=000,325.457 MBps]  [SEND=000,003.142133  RECV=000,003.146344 sec]<br>
(000007/000020) [memory=3,347.297  SEND=000,323.656  RECV=000,324.082 MBps]  [SEND=000,003.163854  RECV=000,003.159691 sec]<br>
(000008/000020) [memory=3,348.379  SEND=000,322.546  RECV=000,323.620 MBps]  [SEND=000,003.174744  RECV=000,003.164209 sec]<br>
(000009/000020) [memory=3,343.477  SEND=000,319.824  RECV=000,325.442 MBps]  [SEND=000,003.201765  RECV=000,003.146494 sec]<br>
(000010/000020) [memory=3,360.573  SEND=000,320.140  RECV=000,325.937 MBps]  [SEND=000,003.198602  RECV=000,003.141710 sec]<br>
(000011/000020) [memory=3,356.278  SEND=000,319.559  RECV=000,325.156 MBps]  [SEND=000,003.204419  RECV=000,003.149256 sec]<br>
(000012/000020) [memory=3,357.076  SEND=000,318.083  RECV=000,323.702 MBps]  [SEND=000,003.219286  RECV=000,003.163399 sec]<br>
(000013/000020) [memory=3,348.365  SEND=000,316.350  RECV=000,321.851 MBps]  [SEND=000,003.236924  RECV=000,003.181597 sec]<br>
(000014/000020) [memory=3,345.184  SEND=000,314.819  RECV=000,320.344 MBps]  [SEND=000,003.252658  RECV=000,003.196560 sec]<br>
(000015/000020) [memory=3,342.649  SEND=000,315.298  RECV=000,320.870 MBps]  [SEND=000,003.247716  RECV=000,003.191325 sec]<br>
(000016/000020) [memory=3,325.359  SEND=000,316.684  RECV=000,322.179 MBps]  [SEND=000,003.233512  RECV=000,003.178357 sec]<br>
(000017/000020) [memory=3,322.083  SEND=000,316.288  RECV=000,321.919 MBps]  [SEND=000,003.237553  RECV=000,003.180928 sec]<br>
(000018/000020) [memory=3,320.656  SEND=000,316.328  RECV=000,321.986 MBps]  [SEND=000,003.237148  RECV=000,003.180259 sec]<br>
(000019/000020) [memory=3,323.505  SEND=000,316.304  RECV=000,322.014 MBps]  [SEND=000,003.237390  RECV=000,003.179990 sec]<br>
(000020/000020) [memory=3,320.593  SEND=000,316.271  RECV=000,322.091 MBps]  [SEND=000,003.237731  RECV=000,003.179221 sec]<br>
(    TOTAL    ) [memory=3,338.120  SEND=000,318.963  RECV=000,322.877 MBps]  [SEND=000,003.210402  RECV=000,003.171487 sec] (TOTAL)<br>
All iterations completed<br>
Summary of results written to [results_BLACKJACK.txt]<br>
Client side data transfer logging was not enabled.<br>
Shutting down client connection
</div>
<div class="dhow">
<span class="sedited">Last edited on <span id="CH_zTm5d839a4596" title="Wed, 06 Jan 2016 14:55:24 +0000"></span><script type="text/javascript">WhenId('CH_zTm5d839a4596');</script><noscript>Jan 6, 2016 at 2:55pm UTC</noscript></span>
<span class="dbtn" id="CH_btn893268"></span>

</div>
</div>
</div>
</div><div class="rootinsMore"></div><div class="rootbtnMore"></div><div class="rootinsNew"></div><div class="rootbtnNew"></div><div id="CH_insNew"></div><div id="CH_reply">Registered users can post here. <a href="/user/">Sign in or register</a> to post.</div><div id="CH_subscription"></div><div class="rootedtNew"></div><script type="text/javascript">new for_PostList(182240,0,206125,0,'CH_PostList','CH_subscription','CH_reply','CH_insNew','CH_edttl','/forum/thread.cgi','/forum/post.cgi','/forum/myposts.cgi',64,32,512,256,1024,16);</script></div>
<script type="text/javascript">
    google_ad_client = "ca-pub-1444228343479937";
    google_ad_slot = "9701143201";
    google_ad_width = 728;
    google_ad_height = 90;
</script>
<!-- leaderboard -->
<script type="text/javascript"
src="//pagead2.googlesyndication.com/pagead/show_ads.js">
</script></div>
<div id="I_nav">
<div class="sect root">
<h3><b><a href="/">C++</a></b></h3>
<ul>
<li class="folder info"><a href="/info/">Information</a></li>
<li class="folder doc"><a href="/doc/">Tutorials</a></li>
<li class="folder reference"><a href="/reference/">Reference</a></li>
<li class="folder articles"><a href="/articles/">Articles</a></li>
<li class="folder selected forum"><a href="/forum/">Forum</a></li>
</ul>
</div>
<div class="sect">
<h3><b><a href="/forum/">Forum</a></b></h3>
<ul>
<li><a href="/forum/beginner/"><b>Beginners</b></a></li><li class="selected"><a href="/forum/windows/"><b>Windows Programming</b></a></li><li><a href="/forum/unices/"><b>UNIX/Linux Programming</b></a></li><li><a href="/forum/general/"><b>General C++ Programming</b></a></li><li><a href="/forum/lounge/"><b>Lounge</b></a></li><li><a href="/forum/jobs/"><b>Jobs</b></a></li></ul>
</div>
<div id="I_subnav"></div>
<div class="C_ad234">
<script type="text/javascript"><!--
google_ad_client = "ca-pub-7688470879129516";
google_ad_slot = "7445514729";
google_ad_width = 234;
google_ad_height = 60;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</div></div>
<div id="I_midclear"></div>
</div>
</div>
<div id="I_bottom">
<div id="I_footer">
	<a href="/">Home page</a> | <a href="/privacy.do">Privacy policy</a><br>&copy; cplusplus.com, 2000-2016 - All rights reserved - <i>v3.1</i><br><a href="/contact.do?referrer=www.cplusplus.com%2Fforum%2Fwindows%2F182240%2F">Spotted an error? contact us</a>
</div>
</div>

<script type="text/javascript">
<!--
function NavFor(us) {document.getElementById('I_subnav').innerHTML=us.ok?'<div class="sect"><h3><b><a href="/user/">'+us.user+'</a></b></h3><ul><li><a href="/forum/myposts.cgi">My topics</a></li></ul></div>':'';}onSession(NavFor);ready();
var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-521783-1']);
_gaq.push(['_trackPageview']);

(function() {
  var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
  ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
  var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();

//-->
</script>

</body>
</html>