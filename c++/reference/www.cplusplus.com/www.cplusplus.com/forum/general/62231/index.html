<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Getting the working directory and conver - C++ Forum</title>
<link rel="shortcut icon" type="image/x-icon" href="/favicon.ico">
<link rel="stylesheet" type="text/css" href="/v321/main.css">
<script src="/v321/main.js" type="text/javascript"></script>
<script type='text/javascript'>
var googletag = googletag || {};
googletag.cmd = googletag.cmd || [];
(function() {
var gads = document.createElement('script');
gads.async = true;
gads.type = 'text/javascript';
var useSSL = 'https:' == document.location.protocol;
gads.src = (useSSL ? 'https:' : 'http:') + 
'//www.googletagservices.com/tag/js/gpt.js';
var node = document.getElementsByTagName('script')[0];
node.parentNode.insertBefore(gads, node);
})();
</script>

<script type='text/javascript'>
googletag.cmd.push(function() {
googletag.defineSlot('/32882001/L', [728, 90], 'div-gpt-ad-1427191279638-0').addService(googletag.pubads());
googletag.enableServices();
});
</script>
</head>
<body>
<div id="I_top">
<div id="I_header">
<div id="I_logo"><a href="/" title="cplusplus.com"><div></div></a></div>
<div id="I_search">
<form id="search" action="/search.do" method="get">
Search: <input name="q" size="20" class="txt"> <input type="submit" value="Go" class="btn">
</form>
</div>
<div id="I_bar">
<ul>
<li><a href="/forum/">Forum</a></li>
<li><a href="/forum/general/">General C++ Programming</a></li>
<li class="here">Getting the working directory and conver</li>
</ul>
</div>
<div id="I_user" class="C_LoginBox"><span title="ajax"></span></div>
</div>
</div>
<div id="I_mid">
<div id="I_wrap">
<div id="I_minheight"></div>
<div id="I_main">
<div class="C_support">
<div id='div-gpt-ad-1427191279638-0' style='width:728px; height:90px;'>
<script type='text/javascript'>
googletag.cmd.push(function() { googletag.display('div-gpt-ad-1427191279638-0'); });
</script>
</div>
</div>
<div id="I_content">
<h3><div class="C_ico solved" title="solved">&nbsp;</div> Getting the working directory and converting to a string</h3><span id="CH_edttl"></span><span class="rootdatPost" title="62231,root,0,-1,12,0"></span><div id="CH_PostList"><div class="C_forPost" id="msg336548"><span title="336548,78831,1023,47,1"></span>
<div class="box">
<div class="boxtop">
<div class="dwhen"><a href="#msg336548" title="Link to this post"><img src="/img/link.png" width="16" height="8"></a> <span id="CH_zTm7472873e9c" title="Sat, 18 Feb 2012 00:46:47 +0000"></span><script type="text/javascript">WhenId('CH_zTm7472873e9c');</script><noscript>Feb 18, 2012 at 12:46am UTC</noscript></div>
<div class="dwho"><a href="/user/snipslog/"><b>snipslog</b> (47)</a></div>
</div>
<div class="dwhat" colspan="2" id="CH_i336548">
As the title says, I am trying to get the working directory and convert it from a LPWSTR to a string. It has to be ASCII and not Unicode because functions later in the code do not support Unicode. Can anyone help me figure out why this isn't working and how to do it right.<br>
<div class="auto"><table class="snippet"><tr><td class="rownum"><pre><code>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br></code></pre></td>
<td class="source"><pre><code>	<var>char</var> * laWorkingDirectory;
	LPWSTR lwWorkingDirectory;

<cite>//get directory of type LPWSTR</cite>
	GetCurrentDirectory(GetCurrentDirectory(0, NULL),
		lwWorkingDirectory);
<cite>//convert to char *</cite>
	WideCharToMultiByte(CP_ACP,
		NULL,
		lwWorkingDirectory,
		-1,
		laWorkingDirectory,
		WideCharToMultiByte(CP_ACP, NULL, lwWorkingDirectory, -1, NULL, 0, NULL, NULL),
		NULL,
		NULL);
<cite>//convert to string</cite>
	string lWorkingDirectory = string(laWorkingDirectory);
	string lFileName = <kbd>""</kbd>;
<cite>//delete temp directories</cite>
	<var>delete</var> [] lwWorkingDirectory, laWorkingDirectory;</code></pre></td><td class="C_btnholder"></td></tr></table></div>

</div>
<div class="dhow">
<span class="sedited">Last edited on <span id="CH_zTmeee9cb3741" title="Sat, 18 Feb 2012 00:50:00 +0000"></span><script type="text/javascript">WhenId('CH_zTmeee9cb3741');</script><noscript>Feb 18, 2012 at 12:50am UTC</noscript></span>
<span class="dbtn" id="CH_btn336548"></span>

</div>
</div>
</div>
<div class="C_forPost" id="msg336554"><span title="336554,75536,1023,7545,0"></span>
<div class="box">
<div class="boxtop">
<div class="dwhen"><a href="#msg336554" title="Link to this post"><img src="/img/link.png" width="16" height="8"></a> <span id="CH_zTmbedeb733da" title="Sat, 18 Feb 2012 01:14:01 +0000"></span><script type="text/javascript">WhenId('CH_zTmbedeb733da');</script><noscript>Feb 18, 2012 at 1:14am UTC</noscript></div>
<div class="dwho"><a href="/user/JLBorges/"><b>JLBorges</b> (7545)</a></div>
</div>
<div class="dwhat" colspan="2" id="CH_i336554">
Either<br>
<div class="auto"><table class="snippet"><tr><td class="rownum"><pre><code>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br></code></pre></td>
<td class="source"><pre><code><dfn>#include &lt;direct.h&gt;</dfn>
<dfn>#include &lt;string&gt;</dfn>

std::string current_working_directory()
{
    <var>char</var>* cwd = _getcwd( 0, 0 ) ; <cite>// **** microsoft specific ****</cite>
    std::string working_directory(cwd) ;
    std::free(cwd) ;
    <var>return</var> working_directory ;
}</code></pre></td><td class="C_btnholder"></td></tr></table></div>
<br>
<br>
or<br>
<div class="auto"><table class="snippet"><tr><td class="rownum"><pre><code>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br></code></pre></td>
<td class="source"><pre><code><dfn>#include &lt;windows.h&gt;</dfn>
<dfn>#include &lt;string&gt;</dfn>

std::string current_working_directory()
{
    <var>char</var> working_directory[MAX_PATH+1] ;
    GetCurrentDirectoryA( <var>sizeof</var>(working_directory), working_directory ) ; <cite>// **** win32 specific ****</cite>
    <var>return</var> working_directory ;
}</code></pre></td><td class="C_btnholder"></td></tr></table></div>
<br>
<br>

</div>
<div class="dhow">
<span class="dbtn" id="CH_btn336554"></span>

</div>
</div>
</div>
<div class="C_forPost" id="msg336558"><span title="336558,24346,1023,2948,0"></span>
<div class="box">
<div class="boxtop">
<div class="dwhen"><a href="#msg336558" title="Link to this post"><img src="/img/link.png" width="16" height="8"></a> <span id="CH_zTmafebf8baa1" title="Sat, 18 Feb 2012 01:19:06 +0000"></span><script type="text/javascript">WhenId('CH_zTmafebf8baa1');</script><noscript>Feb 18, 2012 at 1:19am UTC</noscript></div>
<div class="dwho"><a href="/user/webJose/"><b>webJose</b> (2948)</a></div>
</div>
<div class="dwhat" colspan="2" id="CH_i336558">
Your use of GetCurrentDirectory() is incorrect.  The function returns the required buffer, but you never allocate that buffer.  This is bound to fail.  First find out the required buffer size, then allocate the buffer, then get the data.<br>
<br>
But most importantly, you CAN get the directory as an ANSI string directly!<br>
<br>
<div class="auto"><table class="snippet"><tr><td class="rownum"><pre><code>1<br>2<br>3<br></code></pre></td>
<td class="source"><pre><code>DWORD buffSize = GetCurrentDirectoryA(0, NULL);
laWorkingDirectory = <var>new</var> <var>char</var>[buffSize];
GetCurrentDirectoryA(buffSize, laWorkingDirectory);</code></pre></td><td class="C_btnholder"></td></tr></table></div>
<br>
<br>
And that's it.  You have your data in ANSI format.  Note that it is ANSI and not ASCII.  ASCII is a 7-bit codepage, while ANSI is an 8-bit codepage.
</div>
<div class="dhow">
<span class="dbtn" id="CH_btn336558"></span>

</div>
</div>
</div>
<div class="C_forPost" id="msg336562"><span title="336562,75536,1023,7545,0"></span>
<div class="box">
<div class="boxtop">
<div class="dwhen"><a href="#msg336562" title="Link to this post"><img src="/img/link.png" width="16" height="8"></a> <span id="CH_zTm596bf1c6d6" title="Sat, 18 Feb 2012 01:26:33 +0000"></span><script type="text/javascript">WhenId('CH_zTm596bf1c6d6');</script><noscript>Feb 18, 2012 at 1:26am UTC</noscript></div>
<div class="dwho"><a href="/user/JLBorges/"><b>JLBorges</b> (7545)</a></div>
</div>
<div class="dwhat" colspan="2" id="CH_i336562">
&gt; Your use of GetCurrentDirectory() is incorrect. The function returns the required buffer, <br>
&gt; but you never allocate that buffer. This is bound to fail. <br>
&gt; First find out the required buffer size, then allocate the buffer, then get the data.<br>
<br>
Either RTFM <br>
<a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa364934(v=vs.85).aspx">http://msdn.microsoft.com/en-us/library/windows/desktop/aa364934(v=vs.85).aspx</a><br>
<table class="quote"><tr><td class="qd">If the buffer that is pointed to by lpBuffer is not large enough, the return value specifies the required size of the buffer, in characters, including the null-terminating character.</td></tr></table><br>
<br>
<br>
Or test the actual code<br>
<div class="auto"><table class="snippet"><tr><td class="rownum"><pre><code>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br></code></pre></td>
<td class="source"><pre><code><dfn>#include &lt;Windows.h&gt;</dfn>
<dfn>#include &lt;string&gt;</dfn>

std::string current_working_directory()
{
    <var>char</var> working_directory[MAX_PATH+1] ;
    GetCurrentDirectoryA( <var>sizeof</var>(working_directory), working_directory ) ; <cite>// **** win32 specific ****</cite>
    <var>return</var> working_directory ;
}

<var>int</var> main()
{
    std::cout &lt;&lt; current_working_directory() &lt;&lt; <kbd>'\n'</kbd> ;
}</code></pre></td><td class="C_btnholder"></td></tr></table></div>
<br>
<br>
or both. Before making vacuous pronouncements.
</div>
<div class="dhow">
<span class="sedited">Last edited on <span id="CH_zTmb7861233d6" title="Sat, 18 Feb 2012 01:27:15 +0000"></span><script type="text/javascript">WhenId('CH_zTmb7861233d6');</script><noscript>Feb 18, 2012 at 1:27am UTC</noscript></span>
<span class="dbtn" id="CH_btn336562"></span>

</div>
</div>
</div>
<div class="C_forPost" id="msg336564"><span title="336564,24346,1023,2948,0"></span>
<div class="box">
<div class="boxtop">
<div class="dwhen"><a href="#msg336564" title="Link to this post"><img src="/img/link.png" width="16" height="8"></a> <span id="CH_zTmc8fbc88a0b" title="Sat, 18 Feb 2012 01:32:39 +0000"></span><script type="text/javascript">WhenId('CH_zTmc8fbc88a0b');</script><noscript>Feb 18, 2012 at 1:32am UTC</noscript></div>
<div class="dwho"><a href="/user/webJose/"><b>webJose</b> (2948)</a></div>
</div>
<div class="dwhat" colspan="2" id="CH_i336564">
LOL  JLBorges, I am talking about the code in the orginal post.  I replied and had no idea you had replied before me.  Now get a hold of yourself.  And remember this:  Concurrency:  A poster may post while you are typing YOUR post, so even though it seems that I *should* have known you had posted, well, I didn't.<br>
<br>
So YOU think through before you write stupid comments.  Nice word, though.  Vacuous.
</div>
<div class="dhow">
<span class="dbtn" id="CH_btn336564"></span>

</div>
</div>
</div>
<div class="C_forPost" id="msg336568"><span title="336568,75536,1023,7545,0"></span>
<div class="box">
<div class="boxtop">
<div class="dwhen"><a href="#msg336568" title="Link to this post"><img src="/img/link.png" width="16" height="8"></a> <span id="CH_zTm4c8f5c400d" title="Sat, 18 Feb 2012 01:38:25 +0000"></span><script type="text/javascript">WhenId('CH_zTm4c8f5c400d');</script><noscript>Feb 18, 2012 at 1:38am UTC</noscript></div>
<div class="dwho"><a href="/user/JLBorges/"><b>JLBorges</b> (7545)</a></div>
</div>
<div class="dwhat" colspan="2" id="CH_i336568">
Ok. Fair enough.<br>

</div>
<div class="dhow">
<span class="dbtn" id="CH_btn336568"></span>

</div>
</div>
</div>
<div class="C_forPost" id="msg336574"><span title="336574,78831,1023,47,0"></span>
<div class="box">
<div class="boxtop">
<div class="dwhen"><a href="#msg336574" title="Link to this post"><img src="/img/link.png" width="16" height="8"></a> <span id="CH_zTmc23ed0c4cb" title="Sat, 18 Feb 2012 02:01:48 +0000"></span><script type="text/javascript">WhenId('CH_zTmc23ed0c4cb');</script><noscript>Feb 18, 2012 at 2:01am UTC</noscript></div>
<div class="dwho"><a href="/user/snipslog/"><b>snipslog</b> (47)</a></div>
</div>
<div class="dwhat" colspan="2" id="CH_i336574">
Wow, I left expecting it to take a while for a reply. Anyway, both codes work. I decided to go with WebJose's code just because it gets the size needed for the buffer. I'm trying to keep memory to a minimum. I just noticed that msdn gives ANSI and Unicode equivilants at the very bottom in small print.<br>
<br>
One last thing that is really stupid, I don't think the working directory is what I needed. It is giving me the directory of the project. I need the directory of where it is running, which is where it was built.
</div>
<div class="dhow">
<span class="dbtn" id="CH_btn336574"></span>

</div>
</div>
</div>
<div class="C_forPost" id="msg336583"><span title="336583,24346,1023,2948,0"></span>
<div class="box">
<div class="boxtop">
<div class="dwhen"><a href="#msg336583" title="Link to this post"><img src="/img/link.png" width="16" height="8"></a> <span id="CH_zTmc3b7a6d0da" title="Sat, 18 Feb 2012 02:26:04 +0000"></span><script type="text/javascript">WhenId('CH_zTmc3b7a6d0da');</script><noscript>Feb 18, 2012 at 2:26am UTC</noscript></div>
<div class="dwho"><a href="/user/webJose/"><b>webJose</b> (2948)</a></div>
</div>
<div class="dwhat" colspan="2" id="CH_i336583">
I don't know a direct route, so I'd do this:<br>
<br>
1.  Use GetModuleFileName() to obtain the full path and exe file name.  <a href="http://msdn.microsoft.com/en-us/library/windows/desktop/ms683197(v=vs.85).aspx">http://msdn.microsoft.com/en-us/library/windows/desktop/ms683197(v=vs.85).aspx</a><br>
2.  Strip the file name using PathRemoveFileSpec().  <a href="http://msdn.microsoft.com/en-us/library/windows/desktop/bb773748(v=vs.85).aspx">http://msdn.microsoft.com/en-us/library/windows/desktop/bb773748(v=vs.85).aspx</a>
</div>
<div class="dhow">
<span class="dbtn" id="CH_btn336583"></span>

</div>
</div>
</div>
<div class="C_forPost" id="msg338427"><span title="338427,78831,1023,47,0"></span>
<div class="box">
<div class="boxtop">
<div class="dwhen"><a href="#msg338427" title="Link to this post"><img src="/img/link.png" width="16" height="8"></a> <span id="CH_zTm348a2bf9c3" title="Tue, 21 Feb 2012 21:48:34 +0000"></span><script type="text/javascript">WhenId('CH_zTm348a2bf9c3');</script><noscript>Feb 21, 2012 at 9:48pm UTC</noscript></div>
<div class="dwho"><a href="/user/snipslog/"><b>snipslog</b> (47)</a></div>
</div>
<div class="dwhat" colspan="2" id="CH_i338427">
Sorry for the late reply. I still can't get it to work.<br>
<div class="auto"><table class="snippet"><tr><td class="rownum"><pre><code>1<br>2<br>3<br></code></pre></td>
<td class="source"><pre><code>	<var>char</var> *lWorkingDirectory = <var>new</var> <var>char</var>[MAX_PATH];
	GetModuleFileNameA(NULL, lWorkingDirectory, MAX_PATH);
	PathRemoveFileSpecA(lWorkingDirectory);</code></pre></td><td class="C_btnholder"></td></tr></table></div>
<br>
<br>
I'm getting this error at compile time.<br>
<table class="quote"><tr><td class="qd">TestCM.obj : error LNK2019: unresolved external symbol __imp__PathRemoveFileSpecA@4 referenced in function _main<br>
\Projects\TestCM\Debug\TestCM.exe : fatal error LNK1120: 1 unresolved externals</td></tr></table><br>
I thought it might be a linking error, but i added <span class="auto"><code class="source"><dfn>#include &lt;Shlwapi.h&gt; </dfn></code></span> for the PathRemoveFileSpecA(), and it's library is standard.<br>
<br>
Do you have any idea what it is wrong?
</div>
<div class="dhow">
<span class="dbtn" id="CH_btn338427"></span>

</div>
</div>
</div>
<div class="C_forPost" id="msg338444"><span title="338444,24346,1023,2948,0"></span>
<div class="box">
<div class="boxtop">
<div class="dwhen"><a href="#msg338444" title="Link to this post"><img src="/img/link.png" width="16" height="8"></a> <span id="CH_zTmb18c7f629f" title="Tue, 21 Feb 2012 22:22:04 +0000"></span><script type="text/javascript">WhenId('CH_zTmb18c7f629f');</script><noscript>Feb 21, 2012 at 10:22pm UTC</noscript></div>
<div class="dwho"><a href="/user/webJose/"><b>webJose</b> (2948)</a></div>
</div>
<div class="dwhat" colspan="2" id="CH_i338444">
Link errors are not solved with #includes; they are solved with lib's.  Add the following line to a single CPP file:<br>
<br>
<span class="auto"><code class="source"><dfn>#pragma comment(lib, "Shlwapi.lib") </dfn></code></span><br>
<br>
The lib filename is always listed in the MSDN Online documentation, at the bottom of the page.
</div>
<div class="dhow">
<span class="dbtn" id="CH_btn338444"></span>

</div>
</div>
</div>
<div class="C_forPost" id="msg338465"><span title="338465,37152,1023,8201,0"></span>
<div class="box">
<div class="boxtop">
<div class="dwhen"><a href="#msg338465" title="Link to this post"><img src="/img/link.png" width="16" height="8"></a> <span id="CH_zTmfb56821954" title="Tue, 21 Feb 2012 23:03:27 +0000"></span><script type="text/javascript">WhenId('CH_zTmfb56821954');</script><noscript>Feb 21, 2012 at 11:03pm UTC</noscript></div>
<div class="dwho"><a href="/user/ne555/"><b>ne555</b> (8201)</a></div>
</div>
<div class="dwhat" colspan="2" id="CH_i338465">
¿Isn't there an environment variable that holds the working directory?
</div>
<div class="dhow">
<span class="dbtn" id="CH_btn338465"></span>

</div>
</div>
</div>
<div class="C_forPost" id="msg338471"><span title="338471,78831,1023,47,0"></span>
<div class="box">
<div class="boxtop">
<div class="dwhen"><a href="#msg338471" title="Link to this post"><img src="/img/link.png" width="16" height="8"></a> <span id="CH_zTm2c95adacb7" title="Tue, 21 Feb 2012 23:10:03 +0000"></span><script type="text/javascript">WhenId('CH_zTm2c95adacb7');</script><noscript>Feb 21, 2012 at 11:10pm UTC</noscript></div>
<div class="dwho"><a href="/user/snipslog/"><b>snipslog</b> (47)</a></div>
</div>
<div class="dwhat" colspan="2" id="CH_i338471">
I believe it's _get_pgmptr if that is what you're referring to. Thanks for that webJose. I thought I just needed to add the library to the project properties, but this fixed all the problems. This forum rocks! :)
</div>
<div class="dhow">
<span class="dbtn" id="CH_btn338471"></span>

</div>
</div>
</div>
</div><div class="rootinsMore"></div><div class="rootbtnMore"></div><div class="rootinsNew"></div><div class="rootbtnNew"></div><div id="CH_insNew"></div><div id="CH_reply">Topic archived. No new replies allowed.</div><div id="CH_subscription"></div><div class="rootedtNew"></div><script type="text/javascript">new for_PostList(62231,1,78831,1,'CH_PostList','CH_subscription','CH_reply','CH_insNew','CH_edttl','/forum/thread.cgi','/forum/post.cgi','/forum/myposts.cgi',64,32,512,256,1024,16);</script></div>
<script type="text/javascript">
    google_ad_client = "ca-pub-1444228343479937";
    google_ad_slot = "9701143201";
    google_ad_width = 728;
    google_ad_height = 90;
</script>
<!-- leaderboard -->
<script type="text/javascript"
src="//pagead2.googlesyndication.com/pagead/show_ads.js">
</script></div>
<div id="I_nav">
<div class="sect root">
<h3><b><a href="/">C++</a></b></h3>
<ul>
<li class="folder info"><a href="/info/">Information</a></li>
<li class="folder doc"><a href="/doc/">Tutorials</a></li>
<li class="folder reference"><a href="/reference/">Reference</a></li>
<li class="folder articles"><a href="/articles/">Articles</a></li>
<li class="folder selected forum"><a href="/forum/">Forum</a></li>
</ul>
</div>
<div class="sect">
<h3><b><a href="/forum/">Forum</a></b></h3>
<ul>
<li><a href="/forum/beginner/"><b>Beginners</b></a></li><li><a href="/forum/windows/"><b>Windows Programming</b></a></li><li><a href="/forum/unices/"><b>UNIX/Linux Programming</b></a></li><li class="selected"><a href="/forum/general/"><b>General C++ Programming</b></a></li><li><a href="/forum/lounge/"><b>Lounge</b></a></li><li><a href="/forum/jobs/"><b>Jobs</b></a></li></ul>
</div>
<div id="I_subnav"></div>
<div class="C_ad234">
<script type="text/javascript"><!--
google_ad_client = "ca-pub-7688470879129516";
google_ad_slot = "7445514729";
google_ad_width = 234;
google_ad_height = 60;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</div></div>
<div id="I_midclear"></div>
</div>
</div>
<div id="I_bottom">
<div id="I_footer">
	<a href="/">Home page</a> | <a href="/privacy.do">Privacy policy</a><br>&copy; cplusplus.com, 2000-2016 - All rights reserved - <i>v3.1</i><br><a href="/contact.do?referrer=www.cplusplus.com%2Fforum%2Fgeneral%2F62231%2F">Spotted an error? contact us</a>
</div>
</div>

<script type="text/javascript">
<!--
function NavFor(us) {document.getElementById('I_subnav').innerHTML=us.ok?'<div class="sect"><h3><b><a href="/user/">'+us.user+'</a></b></h3><ul><li><a href="/forum/myposts.cgi">My topics</a></li></ul></div>':'';}onSession(NavFor);ready();
var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-521783-1']);
_gaq.push(['_trackPageview']);

(function() {
  var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
  ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
  var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();

//-->
</script>

</body>
</html>