<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Friendship and circular dependencies - C++ Forum</title>
<link rel="shortcut icon" type="image/x-icon" href="/favicon.ico">
<link rel="stylesheet" type="text/css" href="/v321/main.css">
<script src="/v321/main.js" type="text/javascript"></script>
<script type='text/javascript'>
var googletag = googletag || {};
googletag.cmd = googletag.cmd || [];
(function() {
var gads = document.createElement('script');
gads.async = true;
gads.type = 'text/javascript';
var useSSL = 'https:' == document.location.protocol;
gads.src = (useSSL ? 'https:' : 'http:') + 
'//www.googletagservices.com/tag/js/gpt.js';
var node = document.getElementsByTagName('script')[0];
node.parentNode.insertBefore(gads, node);
})();
</script>

<script type='text/javascript'>
googletag.cmd.push(function() {
googletag.defineSlot('/32882001/L', [728, 90], 'div-gpt-ad-1427191279638-0').addService(googletag.pubads());
googletag.enableServices();
});
</script>
</head>
<body>
<div id="I_top">
<div id="I_header">
<div id="I_logo"><a href="/" title="cplusplus.com"><div></div></a></div>
<div id="I_search">
<form id="search" action="/search.do" method="get">
Search: <input name="q" size="20" class="txt"> <input type="submit" value="Go" class="btn">
</form>
</div>
<div id="I_bar">
<ul>
<li><a href="/forum/">Forum</a></li>
<li><a href="/forum/general/">General C++ Programming</a></li>
<li class="here">Friendship and circular dependencies</li>
</ul>
</div>
<div id="I_user" class="C_LoginBox"><span title="ajax"></span></div>
</div>
</div>
<div id="I_mid">
<div id="I_wrap">
<div id="I_minheight"></div>
<div id="I_main">
<div class="C_support">
<div id='div-gpt-ad-1427191279638-0' style='width:728px; height:90px;'>
<script type='text/javascript'>
googletag.cmd.push(function() { googletag.display('div-gpt-ad-1427191279638-0'); });
</script>
</div>
</div>
<div id="I_content">
<h3><div class="C_ico default" title="post">&nbsp;</div> Friendship and circular dependencies</h3><span id="CH_edttl"></span><span class="rootdatPost" title="44957,root,0,-1,19,0"></span><div id="CH_PostList"><div class="C_forPost" id="msg243862"><span title="243862,60168,1023,13,1"></span>
<div class="box">
<div class="boxtop">
<div class="dwhen"><a href="#msg243862" title="Link to this post"><img src="/img/link.png" width="16" height="8"></a> <span id="CH_zTm9e1c43b1fe" title="Thu, 16 Jun 2011 21:49:35 +0000"></span><script type="text/javascript">WhenId('CH_zTm9e1c43b1fe');</script><noscript>Jun 16, 2011 at 9:49pm UTC</noscript></div>
<div class="dwho"><a href="/user/navarromoral/"><b>navarromoral</b> (13)</a></div>
</div>
<div class="dwhat" colspan="2" id="CH_i243862">
Hello, I would like to know how I could solve the following circular dependency.<br>
<br>
class_A.h<br>
------------<br>
#include "../include/class_B.h"<br>
class class_A<br>
{<br>
    public:<br>
        ...<br>
        friend void class_B::funct();<br>
    ...<br>
};<br>
<br>
class_B.h<br>
------------<br>
#include "../include/class_A.h"<br>
class class_B<br>
{<br>
    public:<br>
        ...<br>
        void funct();<br>
    private:<br>
    class_A temp;<br>
};<br>
<br>
Thanks a lot in advanced!!<br>

</div>
<div class="dhow">
<span class="sedited">Last edited on <span id="CH_zTm42f66ab3a3" title="Fri, 17 Jun 2011 22:27:26 +0000"></span><script type="text/javascript">WhenId('CH_zTm42f66ab3a3');</script><noscript>Jun 17, 2011 at 10:27pm UTC</noscript></span>
<span class="dbtn" id="CH_btn243862"></span>

</div>
</div>
</div>
<div class="C_forPost" id="msg243875"><span title="243875,29924,1023,5406,0"></span>
<div class="box">
<div class="boxtop">
<div class="dwhen"><a href="#msg243875" title="Link to this post"><img src="/img/link.png" width="16" height="8"></a> <span id="CH_zTm8eaea0a50d" title="Thu, 16 Jun 2011 22:30:50 +0000"></span><script type="text/javascript">WhenId('CH_zTm8eaea0a50d');</script><noscript>Jun 16, 2011 at 10:30pm UTC</noscript></div>
<div class="dwho"><a href="/user/Computergeek01/"><b>Computergeek01</b> (5406)</a></div>
</div>
<div class="dwhat" colspan="2" id="CH_i243875">
What makes you think that's what this is?
</div>
<div class="dhow">
<span class="dbtn" id="CH_btn243875"></span>

</div>
</div>
</div>
<div class="C_forPost" id="msg243895"><span title="243895,9110,5119,10134,0"></span>
<div class="box">
<div class="boxtop">
<div class="dwhen"><a href="#msg243895" title="Link to this post"><img src="/img/link.png" width="16" height="8"></a> <span id="CH_zTm26a014e44e" title="Thu, 16 Jun 2011 23:05:58 +0000"></span><script type="text/javascript">WhenId('CH_zTm26a014e44e');</script><noscript>Jun 16, 2011 at 11:05pm UTC</noscript></div>
<div class="dwho"><a href="/user/Duoas/"><b>Duoas</b> (10134)</a></div>
</div>
<div class="dwhat" colspan="2" id="CH_i243895">
What?<br>
<br>
@OP<br>
You need to make one of the classes have a forward reference. Good luck!
</div>
<div class="dhow">
<span class="dbtn" id="CH_btn243895"></span>

</div>
</div>
</div>
<div class="C_forPost" id="msg244078"><span title="244078,60168,1023,13,0"></span>
<div class="box">
<div class="boxtop">
<div class="dwhen"><a href="#msg244078" title="Link to this post"><img src="/img/link.png" width="16" height="8"></a> <span id="CH_zTm9e7bbcbdb7" title="Fri, 17 Jun 2011 07:36:47 +0000"></span><script type="text/javascript">WhenId('CH_zTm9e7bbcbdb7');</script><noscript>Jun 17, 2011 at 7:36am UTC</noscript></div>
<div class="dwho"><a href="/user/navarromoral/"><b>navarromoral</b> (13)</a></div>
</div>
<div class="dwhat" colspan="2" id="CH_i244078">
Thanks a lot for your replys!<br>
<br>
What makes me think this is a circular dependency problem is that I have to include "class_B.h" in class_A.h to refer to the member function class_B::funct(), and I have to include "class_A.h" in class_B.h to declare a class_A object.<br>
<br>
I had already thought of forward declarations, but it doesnÂ´t seem to work. If I insert it in file "class_A.h" then the compiler does not know the member function class_B::funct, and if I insert it in file "class_B.h" the compiler does not know the object class_A.<br>
<br>
Maybe I am missing something... thanks!!
</div>
<div class="dhow">
<span class="sedited">Last edited on <span id="CH_zTm9ade0f493d" title="Fri, 17 Jun 2011 17:30:55 +0000"></span><script type="text/javascript">WhenId('CH_zTm9ade0f493d');</script><noscript>Jun 17, 2011 at 5:30pm UTC</noscript></span>
<span class="dbtn" id="CH_btn244078"></span>

</div>
</div>
</div>
<div class="C_forPost" id="msg244255"><span title="244255,9110,5119,10134,0"></span>
<div class="box">
<div class="boxtop">
<div class="dwhen"><a href="#msg244255" title="Link to this post"><img src="/img/link.png" width="16" height="8"></a> <span id="CH_zTmcc6692bae6" title="Fri, 17 Jun 2011 17:19:35 +0000"></span><script type="text/javascript">WhenId('CH_zTmcc6692bae6');</script><noscript>Jun 17, 2011 at 5:19pm UTC</noscript></div>
<div class="dwho"><a href="/user/Duoas/"><b>Duoas</b> (10134)</a></div>
</div>
<div class="dwhat" colspan="2" id="CH_i244255">
You are missing something. Google "forward class reference". Sorry I can't explain more right now... gotta go!
</div>
<div class="dhow">
<span class="dbtn" id="CH_btn244255"></span>

</div>
</div>
</div>
<div class="C_forPost" id="msg244335"><span title="244335,60168,1023,13,0"></span>
<div class="box">
<div class="boxtop">
<div class="dwhen"><a href="#msg244335" title="Link to this post"><img src="/img/link.png" width="16" height="8"></a> <span id="CH_zTm1a0fddd199" title="Fri, 17 Jun 2011 22:08:47 +0000"></span><script type="text/javascript">WhenId('CH_zTm1a0fddd199');</script><noscript>Jun 17, 2011 at 10:08pm UTC</noscript></div>
<div class="dwho"><a href="/user/navarromoral/"><b>navarromoral</b> (13)</a></div>
</div>
<div class="dwhat" colspan="2" id="CH_i244335">
Nope :) ... I can't see how using forward declarations could solve this problem. Where should I use them??<br>
<br>
Thanks a lot!!
</div>
<div class="dhow">
<span class="sedited">Last edited on <span id="CH_zTmc877207d7f" title="Fri, 17 Jun 2011 22:09:17 +0000"></span><script type="text/javascript">WhenId('CH_zTmc877207d7f');</script><noscript>Jun 17, 2011 at 10:09pm UTC</noscript></span>
<span class="dbtn" id="CH_btn244335"></span>

</div>
</div>
</div>
<div class="C_forPost" id="msg244336"><span title="244336,38387,1023,13301,0"></span>
<div class="box">
<div class="boxtop">
<div class="dwhen"><a href="#msg244336" title="Link to this post"><img src="/img/link.png" width="16" height="8"></a> <span id="CH_zTm77ffdbaaf7" title="Fri, 17 Jun 2011 22:10:35 +0000"></span><script type="text/javascript">WhenId('CH_zTm77ffdbaaf7');</script><noscript>Jun 17, 2011 at 10:10pm UTC</noscript></div>
<div class="dwho"><a href="/user/LB/"><b>LB</b> (13301)</a></div>
</div>
<div class="dwhat" colspan="2" id="CH_i244336">
<del>In _A.h just add<br>
<span class="auto"><code class="source"><var>class</var> class_B;</code></span> (declaration)<br>
before class_A's definition.</del><br>
<br>
<sub>I misread, sorry.</sub>
</div>
<div class="dhow">
<span class="sedited">Last edited on <span id="CH_zTm094d2ba118" title="Fri, 17 Jun 2011 22:24:39 +0000"></span><script type="text/javascript">WhenId('CH_zTm094d2ba118');</script><noscript>Jun 17, 2011 at 10:24pm UTC</noscript></span>
<span class="dbtn" id="CH_btn244336"></span>

</div>
</div>
</div>
<div class="C_forPost" id="msg244341"><span title="244341,60168,1023,13,0"></span>
<div class="box">
<div class="boxtop">
<div class="dwhen"><a href="#msg244341" title="Link to this post"><img src="/img/link.png" width="16" height="8"></a> <span id="CH_zTm60db857381" title="Fri, 17 Jun 2011 22:18:57 +0000"></span><script type="text/javascript">WhenId('CH_zTm60db857381');</script><noscript>Jun 17, 2011 at 10:18pm UTC</noscript></div>
<div class="dwho"><a href="/user/navarromoral/"><b>navarromoral</b> (13)</a></div>
</div>
<div class="dwhat" colspan="2" id="CH_i244341">
Thanks for your reply L B. What you say doesn't work, I get the following error (after removing the #include ...class_B.h)<br>
<br>
C:\temp\dep_Test\src\..\include\class_A.h|11|error: invalid use of incomplete type 'struct class_B'| 9  (LINE:  friend void class_B::funct(); )<br>
<br>
C:\temp\dep_Test\src\..\include\class_A.h|5|error: forward declaration of 'struct class_B'| (line class class_B; )<br>
<br>

</div>
<div class="dhow">
<span class="sedited">Last edited on <span id="CH_zTmce0efe37e2" title="Fri, 17 Jun 2011 22:20:07 +0000"></span><script type="text/javascript">WhenId('CH_zTmce0efe37e2');</script><noscript>Jun 17, 2011 at 10:20pm UTC</noscript></span>
<span class="dbtn" id="CH_btn244341"></span>

</div>
</div>
</div>
<div class="C_forPost" id="msg244344"><span title="244344,38387,1023,13301,0"></span>
<div class="box">
<div class="boxtop">
<div class="dwhen"><a href="#msg244344" title="Link to this post"><img src="/img/link.png" width="16" height="8"></a> <span id="CH_zTm0621cd5318" title="Fri, 17 Jun 2011 22:24:53 +0000"></span><script type="text/javascript">WhenId('CH_zTm0621cd5318');</script><noscript>Jun 17, 2011 at 10:24pm UTC</noscript></div>
<div class="dwho"><a href="/user/LB/"><b>LB</b> (13301)</a></div>
</div>
<div class="dwhat" colspan="2" id="CH_i244344">
Sorry, I misread the code and the topic. Does this help?<br>
<a href="http://www.cplusplus.com/forum/unices/21527/">http://www.cplusplus.com/forum/unices/21527/</a>
</div>
<div class="dhow">
<span class="dbtn" id="CH_btn244344"></span>

</div>
</div>
</div>
<div class="C_forPost" id="msg244349"><span title="244349,60168,1023,13,0"></span>
<div class="box">
<div class="boxtop">
<div class="dwhen"><a href="#msg244349" title="Link to this post"><img src="/img/link.png" width="16" height="8"></a> <span id="CH_zTmd9152fee6f" title="Fri, 17 Jun 2011 22:38:44 +0000"></span><script type="text/javascript">WhenId('CH_zTmd9152fee6f');</script><noscript>Jun 17, 2011 at 10:38pm UTC</noscript></div>
<div class="dwho"><a href="/user/navarromoral/"><b>navarromoral</b> (13)</a></div>
</div>
<div class="dwhat" colspan="2" id="CH_i244349">
Thanks L B! this indeed solves the errors, but what I am interested in is to understand what the problem is with my code. <br>
<br>
The problem appears when I declare the friend member function, and as far as I know, this should not interfere with anything and should be possible to do.<br>
<br>
Am I wrong??
</div>
<div class="dhow">
<span class="dbtn" id="CH_btn244349"></span>

</div>
</div>
</div>
<div class="C_forPost" id="msg244435"><span title="244435,23666,1023,788,0"></span>
<div class="box">
<div class="boxtop">
<div class="dwhen"><a href="#msg244435" title="Link to this post"><img src="/img/link.png" width="16" height="8"></a> <span id="CH_zTm3238e68d44" title="Sat, 18 Jun 2011 04:30:19 +0000"></span><script type="text/javascript">WhenId('CH_zTm3238e68d44');</script><noscript>Jun 18, 2011 at 4:30am UTC</noscript></div>
<div class="dwho"><a href="/user/kfmfe04/"><b>kfmfe04</b> (788)</a></div>
</div>
<div class="dwhat" colspan="2" id="CH_i244435">
well, friends are an acceptable C++ construct, but for practical uses, you should use it as little as possible, as it breaks encapsulation<br>
<br>
so whenever possible, refactor your code to avoid using it<br>
<br>
also, circular dependencies are usually a flaw in the design; in fact, whenever possible, dependencies should always go in one direction (top to bottom) - however, when there is tight coupling that cannot be avoided between two classes, I will usually keep the two classes in the same source file for easier maintenance<br>
<br>
specifically, what is the relationship between class A and B?  post your real code - perhaps there is a way to loosen the coupling between the two.
</div>
<div class="dhow">
<span class="dbtn" id="CH_btn244435"></span>

</div>
</div>
</div>
<div class="C_forPost" id="msg244544"><span title="244544,9110,5119,10134,0"></span>
<div class="box">
<div class="boxtop">
<div class="dwhen"><a href="#msg244544" title="Link to this post"><img src="/img/link.png" width="16" height="8"></a> <span id="CH_zTm8399c4a2bf" title="Sat, 18 Jun 2011 17:50:27 +0000"></span><script type="text/javascript">WhenId('CH_zTm8399c4a2bf');</script><noscript>Jun 18, 2011 at 5:50pm UTC</noscript></div>
<div class="dwho"><a href="/user/Duoas/"><b>Duoas</b> (10134)</a></div>
</div>
<div class="dwhat" colspan="2" id="CH_i244544">
<table class="quote"><tr><td class="qd">as it breaks encapsulation</td></tr></table><br>
No it doesn't. <a href="http://www.parashift.com/c++-faq-lite/friends.html#faq-14.2">http://www.parashift.com/c++-faq-lite/friends.html#faq-14.2</a>
</div>
<div class="dhow">
<span class="dbtn" id="CH_btn244544"></span>

</div>
</div>
</div>
<div class="C_forPost" id="msg244578"><span title="244578,23666,1023,788,0"></span>
<div class="box">
<div class="boxtop">
<div class="dwhen"><a href="#msg244578" title="Link to this post"><img src="/img/link.png" width="16" height="8"></a> <span id="CH_zTmbc8f016c7e" title="Sat, 18 Jun 2011 19:30:49 +0000"></span><script type="text/javascript">WhenId('CH_zTmbc8f016c7e');</script><noscript>Jun 18, 2011 at 7:30pm UTC</noscript></div>
<div class="dwho"><a href="/user/kfmfe04/"><b>kfmfe04</b> (788)</a></div>
</div>
<div class="dwhat" colspan="2" id="CH_i244578">
of course, it breaks encapsulation (don't believe everything you read - think about what they are saying)!<br>
<br>
<table class="quote"><tr><th class="qh"><strong>FAQ</strong> wrote:</th></tr><tr><td class="qd">You often need to split a class in half when the two halves will have different numbers of instances or different lifetimes. In these cases, the two halves usually need direct access to each other (the two halves used to be in the same class, so you haven't increased the amount of code that needs direct access to a data structure; you've simply reshuffled the code into two classes instead of one). The safest way to implement this is to make the two halves friends of each other.</td></tr></table><br>
damn!  making A a friend of B is apparently not bad enough - let's also make B a friend of A?!?!?<br>
<b>you</b> can maintain that code if you like - I prefer not to<br>
<br>
the safest way in that case, is to refactor and place proper parts of the code into a <b>nested class</b> and control access properly - not break it wide open in both directions by making mutual friends<br>
<br>
using a friend in the example described in that FAQ is definitely a sign of laziness, the evil kind<br>
<br>
edit: I guarantee that if you do what the FAQ suggests, one day, A will grow and B will grow, and before you know it, you will quickly evolve your code into the OOP equivalent of spaghetti code (actually, it will be harder to debug than imperative spaghetti code)
</div>
<div class="dhow">
<span class="sedited">Last edited on <span id="CH_zTm283c2ce991" title="Sat, 18 Jun 2011 19:35:05 +0000"></span><script type="text/javascript">WhenId('CH_zTm283c2ce991');</script><noscript>Jun 18, 2011 at 7:35pm UTC</noscript></span>
<span class="dbtn" id="CH_btn244578"></span>

</div>
</div>
</div>
<div class="C_forPost" id="msg244582"><span title="244582,18360,1023,13765,0"></span>
<div class="box">
<div class="boxtop">
<div class="dwhen"><a href="#msg244582" title="Link to this post"><img src="/img/link.png" width="16" height="8"></a> <span id="CH_zTmfad4a0615c" title="Sat, 18 Jun 2011 19:47:20 +0000"></span><script type="text/javascript">WhenId('CH_zTmfad4a0615c');</script><noscript>Jun 18, 2011 at 7:47pm UTC</noscript></div>
<div class="dwho"><a href="/user/Disch/"><b>Disch</b> (13765)</a></div>
</div>
<div class="dwhat" colspan="2" id="CH_i244582">
<table class="quote"><tr><th class="qh"><strong>kfmfe04</strong> wrote:</th></tr><tr><td class="qd">of course, it breaks encapsulation</td></tr></table><br>
<br>
Of course it <i>can</i> break encapsulation, that doesn't mean it <i>does</i> break encapsulation.<br>
<br>
One of the more practical applications for friendship is an iterator for a container class.<br>
<br>
Clearly the container and the iterators are separate objects, so you can't use the same class.<br>
<br>
Furthermore, the iterator will need a way to access the raw data that the container manages (in some form)<br>
<br>
Lastly, you don't want the end user to be able to access the raw data the way the iterator needs to.<br>
<br>
<br>
Therefore, to <i>enhance encapsulation</i> you give the iterators a private constructor, and make the container a friend.  Now the container can create iterators as needed, but the end user is not exposed to how it works internally.<br>
<br>
The only option around that is to build iterating functionality into the container class instead of using a separate iterator class (yuk), or make the key constructor public, exposing inner storage and management details to the user (poor encapsulation).<br>
<br>
So in that case, friendship enhances encapsulation.  It does not violate it.<br>
<br>
AFAIK that's how containers like std::map and std::list work.  I don't know about you, but I consider them to be very well encapsulated.<br>
<br>
<br>
<br>
EDIT:<br>
<br>
Though I agree with you on your main point.  friendship is more often than not abused and used incorrectly.  Such tight coupling is very rarely needed between classes.
</div>
<div class="dhow">
<span class="sedited">Last edited on <span id="CH_zTmd2b4e1029f" title="Sat, 18 Jun 2011 19:48:20 +0000"></span><script type="text/javascript">WhenId('CH_zTmd2b4e1029f');</script><noscript>Jun 18, 2011 at 7:48pm UTC</noscript></span>
<span class="dbtn" id="CH_btn244582"></span>

</div>
</div>
</div>
<div class="C_forPost" id="msg244608"><span title="244608,23666,1023,788,0"></span>
<div class="box">
<div class="boxtop">
<div class="dwhen"><a href="#msg244608" title="Link to this post"><img src="/img/link.png" width="16" height="8"></a> <span id="CH_zTm53bc328b10" title="Sat, 18 Jun 2011 21:27:50 +0000"></span><script type="text/javascript">WhenId('CH_zTm53bc328b10');</script><noscript>Jun 18, 2011 at 9:27pm UTC</noscript></div>
<div class="dwho"><a href="/user/kfmfe04/"><b>kfmfe04</b> (788)</a></div>
</div>
<div class="dwhat" colspan="2" id="CH_i244608">
Disch, you have listed a very specific case where using friend is warranted<br>
<br>
but if I understand correctly, that's making the iterator a friend for the container so that you can only get an instance of an iterator through the container, which is fine<br>
<br>
also, I agree that in making iterator a friend for the container, <u>you are breaking class level encapsulation</u> (by using friend) <u>in order to provide for library-level encapsulation</u> (users of the library cannot instantiate an iterator), which makes life harder for the maintainer, but easier for the user, which I'm okay with, especially since I don't maintain the STL<br>
<br>
however, notice that FAQ actually advocates making each class a <b>mutual friend</b> of the other as the safest way to implement something?!?<br>
<br>
maybe you can show me an example where that is true, because I can't seem to come up with anything<br>
<br>
edit:  never mind - don't waste your time - I just got annoyed by the FAQ dispensing advice that most readers wouldn't take the time to think about and evaluate on their own; there are many answers in that FAQ that seem to try to show how clever the writers are, rather than dispensing sound advice
</div>
<div class="dhow">
<span class="sedited">Last edited on <span id="CH_zTmb529dc500f" title="Sat, 18 Jun 2011 21:40:38 +0000"></span><script type="text/javascript">WhenId('CH_zTmb529dc500f');</script><noscript>Jun 18, 2011 at 9:40pm UTC</noscript></span>
<span class="dbtn" id="CH_btn244608"></span>

</div>
</div>
</div>
<div class="C_forPost" id="msg244628"><span title="244628,18360,1023,13765,0"></span>
<div class="box">
<div class="boxtop">
<div class="dwhen"><a href="#msg244628" title="Link to this post"><img src="/img/link.png" width="16" height="8"></a> <span id="CH_zTm7cfb6c2483" title="Sat, 18 Jun 2011 22:48:27 +0000"></span><script type="text/javascript">WhenId('CH_zTm7cfb6c2483');</script><noscript>Jun 18, 2011 at 10:48pm UTC</noscript></div>
<div class="dwho"><a href="/user/Disch/"><b>Disch</b> (13765)</a></div>
</div>
<div class="dwhat" colspan="2" id="CH_i244628">
<table class="quote"><tr><th class="qh"><strong>kfmfe04</strong> wrote:</th></tr><tr><td class="qd">you are breaking class level encapsulation (by using friend) in order to provide for library-level encapsulation (users of the library cannot instantiate an iterator)</td></tr></table><br>
<br>
Sounds to me like you're splitting hairs.  Though I guess it depends on how you define your terms.<br>
<br>
One could argue that std::list&lt;T&gt;::iterator is part of the std::list&lt;T&gt; class (which it is, depending on how you define "part of") and therefore it does not violate class level encapsulation.  It's just two different parts of the same class talking to each other.<br>
<br>
I won't make that argument though, because I don't care enough about it.<br>
<br>
<br>
<br>
From my viewpoint, encapsulation is about separating interface from implementation.  STL container classes, with their use of friendship, do exactly that.  Whether you define that separation on a class level or on a broader level is completely arbitrary and irrelevant.<br>
<br>
The bottom line (again, from my viewpoint) is that:<br>
<br>
- with friendship, std::list&lt;T&gt; and std::list&lt;T&gt;::iterator can be properly encapsulated from the user's standpoint<br>
<br>
- without friendship, they can't be<br>
<br>
Going from that, friendship does not hinder encapsulation in any sense of the word.<br>
<br>
So if you want to draw the line and say that "encapsulation means it must be contained within a single class", then you're either left with compromising that with friendship, or violating it completely to expose internals to the end user.<br>
<br>
<br>
But again drawing that line at a class boundary is arbitrary.  It's just the most convenient place to draw the line in <i>most</i> situations.<br>
<br>
<table class="quote"><tr><td class="qd">which makes life harder for the maintainer, but easier for the user,</td></tr></table><br>
<br>
That's kind of the point.  In fact, you're more or less describing OOP as a whole with that statement.<br>
<br>
Compare std::string (OOP) verses strcpy, etc functions (procedural).<br>
<br>
- string is a lot harder to write and maintain<br>
- string is a lot easier and safer to use<br>
<br>
<br>
While maintaining string might be more difficult, maintaining programs that use string is easier.<br>
<br>
When working on larger projects, maintaining individual classes might be more difficult, but maintaining the project as a whole is a lot easier.<br>
<br>
<br>
<table class="quote"><tr><td class="qd">however, notice that FAQ actually advocates making each class a mutual friend of the other as the safest way to implement something?!?</td></tr></table><br>
<br>
I'm less interested in defending the FAQ author than I am in defending the merits of friendship.<br>
<br>
I don't really agree with his example, but I do agree with his overall message.
</div>
<div class="dhow">
<span class="dbtn" id="CH_btn244628"></span>

</div>
</div>
</div>
<div class="C_forPost" id="msg245165"><span title="245165,9110,5119,10134,0"></span>
<div class="box">
<div class="boxtop">
<div class="dwhen"><a href="#msg245165" title="Link to this post"><img src="/img/link.png" width="16" height="8"></a> <span id="CH_zTm312bfe772e" title="Mon, 20 Jun 2011 18:20:36 +0000"></span><script type="text/javascript">WhenId('CH_zTm312bfe772e');</script><noscript>Jun 20, 2011 at 6:20pm UTC</noscript></div>
<div class="dwho"><a href="/user/Duoas/"><b>Duoas</b> (10134)</a></div>
</div>
<div class="dwhat" colspan="2" id="CH_i245165">
<b>kfmfe04</b><br>
Your terms are too narrow and you are putting your own personal bias on the meaning of <i>encapsulation</i> in C++.<br>
<br>
Friends do not break encapsulation. A friend function|object is <i>part</i> of the class API. What breaks encapsulation is when unrelated, external things know too much about the inner workings of your class. Friends don't do that.**<br>
<br>
A prime example is the overloaded stream insertion and extraction manipulators. Given some class, <b>Foo</b>, does it break encapsulation for a function to be defined as:<br>
<div class="auto"><table class="snippet"><tr><td class="rownum"><pre><code>1<br>2<br>3<br>4<br></code></pre></td>
<td class="source"><pre><code>std::ostream&amp; <var>operator</var> &lt;&lt; ( std::ostream&amp; outs, <var>const</var> Foo&amp; foo )
  {
  ...
  }</code></pre></td><td class="C_btnholder"></td></tr></table></div>
<br>
Of course it does not. Serializing the object is part of the class API.<br>
<br>
Just because the serialization is not a <i>member function</i> does not mean that it breaks encapsulation.<br>
<br>
I don't much care for the FAQ's example either, but it is just one of many. <b>Marshall Cline</b> has, I suspect, far more experience in computer systems than you do, but beyond that, he is intimately familiar with the language's design, having served on the ISO C++ standardization committee. As a well-known and recognized, preeminent computer scientist who is very specific in his choice of words in technical issues, I think his opinion holds some hefty weight when he says, quite clearly, that <table class="quote"><tr><td class="qd">If they're used properly, they <i>enhance</i> encapsulation.</td></tr></table><br>
He also addresses your point of argument directly:<table class="quote"><tr><td class="qd">(Many people think of a friend function as something outside the class. Instead, try thinking of a friend function as part of the class's public interface. A friend function in the class declaration doesn't violate encapsulation any more than a public member function violates encapsulation: both have exactly the same authority with respect to accessing the class's non-public parts.) </td></tr></table><br>
<br>
**caveat: Friends <i>could be used</i> to break encapsulation, but simply that it is possible to abuse the language doesn't make a valid argument against it. You can abuse anything. The abuse of a thing is a different topic than the valid use of a thing. That is logic 101.<br>
<br>
<table class="quote"><tr><td class="qd">edit: never mind - don't waste your time - I just got annoyed by the FAQ dispensing advice that most readers wouldn't take the time to think about and evaluate on their own; there are many answers in that FAQ that seem to try to show how clever the writers are, rather than dispensing sound advice </td></tr></table>And I presume that by "sound advice" you mean advice that comes from years of use in industry. I think that you are trying to show how clever you are, instead of simply accepting that you were wrong about encapsulation and friends and moving on with your newfound tidbit of knowledge.<br>
<br>
Bye.
</div>
<div class="dhow">
<span class="dbtn" id="CH_btn245165"></span>

</div>
</div>
</div>
<div class="C_forPost" id="msg245384"><span title="245384,23666,1023,788,0"></span>
<div class="box">
<div class="boxtop">
<div class="dwhen"><a href="#msg245384" title="Link to this post"><img src="/img/link.png" width="16" height="8"></a> <span id="CH_zTm7d5fc2fc5b" title="Tue, 21 Jun 2011 10:54:21 +0000"></span><script type="text/javascript">WhenId('CH_zTm7d5fc2fc5b');</script><noscript>Jun 21, 2011 at 10:54am UTC</noscript></div>
<div class="dwho"><a href="/user/kfmfe04/"><b>kfmfe04</b> (788)</a></div>
</div>
<div class="dwhat" colspan="2" id="CH_i245384">
sorry - I'm too busy porting 30k LOC of C++ production server code into Google's Go to reply<br>
<br>
...expect it to take &lt;8k LOC in Go<br>
<br>
I think I'm done with C++<br>
<br>
bye
</div>
<div class="dhow">
<span class="dbtn" id="CH_btn245384"></span>

</div>
</div>
</div>
<div class="C_forPost" id="msg245657"><span title="245657,26384,1023,285,0"></span>
<div class="box">
<div class="boxtop">
<div class="dwhen"><a href="#msg245657" title="Link to this post"><img src="/img/link.png" width="16" height="8"></a> <span id="CH_zTmd332e81b07" title="Wed, 22 Jun 2011 07:25:55 +0000"></span><script type="text/javascript">WhenId('CH_zTmd332e81b07');</script><noscript>Jun 22, 2011 at 7:25am UTC</noscript></div>
<div class="dwho"><a href="/user/Abramus/"><b>Abramus</b> (285)</a></div>
</div>
<div class="dwhat" colspan="2" id="CH_i245657">
All I really have to say here is that <span class="auto"><code class="source"><var>friend</var></code></span> does not break encapsulation, simply because <span class="auto"><code class="source"><var>private</var></code></span> does not provide encapsulation, at least in my understanding of the term "encapsulation".
</div>
<div class="dhow">
<span class="dbtn" id="CH_btn245657"></span>

</div>
</div>
</div>
</div><div class="rootinsMore"></div><div class="rootbtnMore"></div><div class="rootinsNew"></div><div class="rootbtnNew"></div><div id="CH_insNew"></div><div id="CH_reply">Topic archived. No new replies allowed.</div><div id="CH_subscription"></div><div class="rootedtNew"></div><script type="text/javascript">new for_PostList(44957,1,60168,0,'CH_PostList','CH_subscription','CH_reply','CH_insNew','CH_edttl','/forum/thread.cgi','/forum/post.cgi','/forum/myposts.cgi',64,32,512,256,1024,16);</script></div>
<script type="text/javascript">
    google_ad_client = "ca-pub-1444228343479937";
    google_ad_slot = "9701143201";
    google_ad_width = 728;
    google_ad_height = 90;
</script>
<!-- leaderboard -->
<script type="text/javascript"
src="//pagead2.googlesyndication.com/pagead/show_ads.js">
</script></div>
<div id="I_nav">
<div class="sect root">
<h3><b><a href="/">C++</a></b></h3>
<ul>
<li class="folder info"><a href="/info/">Information</a></li>
<li class="folder doc"><a href="/doc/">Tutorials</a></li>
<li class="folder reference"><a href="/reference/">Reference</a></li>
<li class="folder articles"><a href="/articles/">Articles</a></li>
<li class="folder selected forum"><a href="/forum/">Forum</a></li>
</ul>
</div>
<div class="sect">
<h3><b><a href="/forum/">Forum</a></b></h3>
<ul>
<li><a href="/forum/beginner/"><b>Beginners</b></a></li><li><a href="/forum/windows/"><b>Windows Programming</b></a></li><li><a href="/forum/unices/"><b>UNIX/Linux Programming</b></a></li><li class="selected"><a href="/forum/general/"><b>General C++ Programming</b></a></li><li><a href="/forum/lounge/"><b>Lounge</b></a></li><li><a href="/forum/jobs/"><b>Jobs</b></a></li></ul>
</div>
<div id="I_subnav"></div>
<div class="C_ad234">
<script type="text/javascript"><!--
google_ad_client = "ca-pub-7688470879129516";
google_ad_slot = "7445514729";
google_ad_width = 234;
google_ad_height = 60;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</div></div>
<div id="I_midclear"></div>
</div>
</div>
<div id="I_bottom">
<div id="I_footer">
	<a href="/">Home page</a> | <a href="/privacy.do">Privacy policy</a><br>&copy; cplusplus.com, 2000-2016 - All rights reserved - <i>v3.1</i><br><a href="/contact.do?referrer=www.cplusplus.com%2Fforum%2Fgeneral%2F44957%2F">Spotted an error? contact us</a>
</div>
</div>

<script type="text/javascript">
<!--
function NavFor(us) {document.getElementById('I_subnav').innerHTML=us.ok?'<div class="sect"><h3><b><a href="/user/">'+us.user+'</a></b></h3><ul><li><a href="/forum/myposts.cgi">My topics</a></li></ul></div>':'';}onSession(NavFor);ready();
var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-521783-1']);
_gaq.push(['_trackPageview']);

(function() {
  var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
  ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
  var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();

//-->
</script>

</body>
</html>