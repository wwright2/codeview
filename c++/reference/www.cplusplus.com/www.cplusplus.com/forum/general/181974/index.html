<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>unordered_map not working in class - C++ Forum</title>
<link rel="shortcut icon" type="image/x-icon" href="/favicon.ico">
<link rel="stylesheet" type="text/css" href="/v321/main.css">
<script src="/v321/main.js" type="text/javascript"></script>
<script type='text/javascript'>
var googletag = googletag || {};
googletag.cmd = googletag.cmd || [];
(function() {
var gads = document.createElement('script');
gads.async = true;
gads.type = 'text/javascript';
var useSSL = 'https:' == document.location.protocol;
gads.src = (useSSL ? 'https:' : 'http:') + 
'//www.googletagservices.com/tag/js/gpt.js';
var node = document.getElementsByTagName('script')[0];
node.parentNode.insertBefore(gads, node);
})();
</script>

<script type='text/javascript'>
googletag.cmd.push(function() {
googletag.defineSlot('/32882001/L', [728, 90], 'div-gpt-ad-1427191279638-0').addService(googletag.pubads());
googletag.enableServices();
});
</script>
</head>
<body>
<div id="I_top">
<div id="I_header">
<div id="I_logo"><a href="/" title="cplusplus.com"><div></div></a></div>
<div id="I_search">
<form id="search" action="/search.do" method="get">
Search: <input name="q" size="20" class="txt"> <input type="submit" value="Go" class="btn">
</form>
</div>
<div id="I_bar">
<ul>
<li><a href="/forum/">Forum</a></li>
<li><a href="/forum/general/">General C++ Programming</a></li>
<li class="here">unordered_map not working in class</li>
</ul>
</div>
<div id="I_user" class="C_LoginBox"><span title="ajax"></span></div>
</div>
</div>
<div id="I_mid">
<div id="I_wrap">
<div id="I_minheight"></div>
<div id="I_main">
<div class="C_support">
<div id='div-gpt-ad-1427191279638-0' style='width:728px; height:90px;'>
<script type='text/javascript'>
googletag.cmd.push(function() { googletag.display('div-gpt-ad-1427191279638-0'); });
</script>
</div>
</div>
<div id="I_content">
<h3><div class="C_ico solved" title="solved">&nbsp;</div> unordered_map not working in class</h3><span id="CH_edttl"></span><span class="rootdatPost" title="181974,root,0,-1,8,0"></span><div id="CH_PostList"><div class="C_forPost" id="msg892174"><span title="892174,205503,255,9,1"></span>
<div class="box">
<div class="boxtop">
<div class="dwhen"><a href="#msg892174" title="Link to this post"><img src="/img/link.png" width="16" height="8"></a> <span id="CH_zTmd00b184254" title="Thu, 31 Dec 2015 04:23:19 +0000"></span><script type="text/javascript">WhenId('CH_zTmd00b184254');</script><noscript>Dec 31, 2015 at 4:23am UTC</noscript></div>
<div class="dwho"><a href="/user/Gadersd/"><b>Gadersd</b> (9)</a></div>
</div>
<div class="dwhat" colspan="2" id="CH_i892174">
<div class="auto"><table class="snippet"><tr><td class="rownum"><pre><code>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br></code></pre></td>
<td class="source"><pre><code><var>class</var> State
{
    <var>public</var>:
        State();
        
    <var>protected</var>:
    <var>private</var>:
        std::unordered_map&lt;std::string,std::unique_ptr&lt;<var>int</var>&gt;&gt; objects;
};</code></pre></td><td class="C_btnholder"></td></tr></table></div>
<br>
<br>
This code will not compile. CodeBlocks gives me <br>
c:\mingw\lib\gcc\mingw32\4.8.1\include\c++\bits\hashtable_policy.h||In instantiation of 'std::__detail::_Hash_node&lt;_Value, true&gt;::_Hash_node(_Args&amp;&amp; ...) [with _Args = {const std::pair&lt;const std::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt;, std::unique_ptr&lt;int, std::default_delete&lt;int&gt; &gt; &gt;&amp;}; _Value = std::pair&lt;const std::basic_string&lt;char&gt;, std::unique_ptr&lt;int&gt; &gt;]':|<br>
c:\mingw\lib\gcc\mingw32\4.8.1\include\c++\ext\new_allocator.h|120|required from 'void __gnu_cxx::new_allocator&lt;_Tp&gt;::construct(_Up*, _Args&amp;&amp; ...) [with _Up = std::__detail::_Hash_node&lt;std::pair&lt;const std::basic_string&lt;char&gt;, std::unique_ptr&lt;int&gt; &gt;, true&gt;; _Args = {const std::pair&lt;const std::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt;, std::unique_ptr&lt;int, std::default_delete&lt;int&gt; &gt; &gt;&amp;}; _Tp = std::__detail::_Hash_node&lt;std::pair&lt;const std::basic_string&lt;char&gt;, std::unique_ptr&lt;int&gt; &gt;, true&gt;]'|<br>
c:\mingw\lib\gcc\mingw32\4.8.1\include\c++\bits\hashtable.h|727|required from 'std::_Hashtable&lt;_Key, _Value, _Alloc, _ExtractKey, _Equal, _H1, _H2, _Hash, _RehashPolicy, _Traits&gt;::__node_type* std::_Hashtable&lt;_Key, _Value, _Alloc, _ExtractKey, _Equal, _H1, _H2, _Hash, _RehashPolicy, _Traits&gt;::_M_allocate_node(_Args&amp;&amp; ...) [with _Args = {const std::pair&lt;const std::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt;, std::unique_ptr&lt;int, std::default_delete&lt;int&gt; &gt; &gt;&amp;}; _Key = std::basic_string&lt;char&gt;; _Value = std::pair&lt;const std::basic_string&lt;char&gt;, std::un|<br>
c:\mingw\lib\gcc\mingw32\4.8.1\include\c++\bits\hashtable.h|898|required from 'std::_Hashtable&lt;_Key, _Value, _Alloc, _ExtractKey, _Equal, _H1, _H2, _Hash, _RehashPolicy, _Traits&gt;::_Hashtable(const std::_Hashtable&lt;_Key, _Value, _Alloc, _ExtractKey, _Equal, _H1, _H2, _Hash, _RehashPolicy, _Traits&gt;&amp;) [with _Key = std::basic_string&lt;char&gt;; _Value = std::pair&lt;const std::basic_string&lt;char&gt;, std::unique_ptr&lt;int&gt; &gt;; _Alloc = std::allocator&lt;std::pair&lt;const std::basic_string&lt;char&gt;, std::unique_ptr&lt;int&gt; &gt; &gt;; _ExtractKey = std::__detail::_Select1st; _Equal = std::equal_to&lt;std::basi|<br>
c:\mingw\lib\gcc\mingw32\4.8.1\include\c++\bits\hashtable.h|425|required from 'std::_Hashtable&lt;_Key, _Value, _Alloc, _ExtractKey, _Equal, _H1, _H2, _Hash, _RehashPolicy, _Traits&gt;&amp; std::_Hashtable&lt;_Key, _Value, _Alloc, _ExtractKey, _Equal, _H1, _H2, _Hash, _RehashPolicy, _Traits&gt;::operator=(const std::_Hashtable&lt;_Key, _Value, _Alloc, _ExtractKey, _Equal, _H1, _H2, _Hash, _RehashPolicy, _Traits&gt;&amp;) [with _Key = std::basic_string&lt;char&gt;; _Value = std::pair&lt;const std::basic_string&lt;char&gt;, std::unique_ptr&lt;int&gt; &gt;; _Alloc = std::allocator&lt;std::pair&lt;const std::basic_string&lt;char&gt;,|<br>
c:\mingw\lib\gcc\mingw32\4.8.1\include\c++\bits\unordered_map.h|97|required from here|<br>
c:\mingw\lib\gcc\mingw32\4.8.1\include\c++\bits\hashtable_policy.h|177|error: use of deleted function 'constexpr std::pair&lt;_T1, _T2&gt;::pair(const std::pair&lt;_T1, _T2&gt;&amp;) [with _T1 = const std::basic_string&lt;char&gt;; _T2 = std::unique_ptr&lt;int&gt;]'|<br>
c:\mingw\lib\gcc\mingw32\4.8.1\include\c++\bits\stl_pair.h|127|note: 'constexpr std::pair&lt;_T1, _T2&gt;::pair(const std::pair&lt;_T1, _T2&gt;&amp;) [with _T1 = const std::basic_string&lt;char&gt;; _T2 = std::unique_ptr&lt;int&gt;]' is implicitly deleted because the default definition would be ill-formed:|<br>
c:\mingw\lib\gcc\mingw32\4.8.1\include\c++\bits\stl_pair.h|127|error: use of deleted function 'std::unique_ptr&lt;_Tp, _Dp&gt;::unique_ptr(const std::unique_ptr&lt;_Tp, _Dp&gt;&amp;) [with _Tp = int; _Dp = std::default_delete&lt;int&gt;]'|<br>
c:\mingw\lib\gcc\mingw32\4.8.1\include\c++\bits\unique_ptr.h|273|error: declared here|<br>
||=== Build failed: 3 error(s), 9 warning(s) (0 minute(s), 1 second(s)) ===|<br>
<br>
Strangely, the code compiles when the unordered_map declaration is moved to the main function. Why is this happening?
</div>
<div class="dhow">
<span class="sedited">Last edited on <span id="CH_zTm62dfe1009b" title="Thu, 31 Dec 2015 04:57:47 +0000"></span><script type="text/javascript">WhenId('CH_zTm62dfe1009b');</script><noscript>Dec 31, 2015 at 4:57am UTC</noscript></span>
<span class="dbtn" id="CH_btn892174"></span>

</div>
</div>
</div>
<div class="C_forPost" id="msg892187"><span title="892187,72446,1023,7402,0"></span>
<div class="box">
<div class="boxtop">
<div class="dwhen"><a href="#msg892187" title="Link to this post"><img src="/img/link.png" width="16" height="8"></a> <span id="CH_zTm082efa24e9" title="Thu, 31 Dec 2015 09:05:39 +0000"></span><script type="text/javascript">WhenId('CH_zTm082efa24e9');</script><noscript>Dec 31, 2015 at 9:05am UTC</noscript></div>
<div class="dwho"><a href="/user/Peter87/"><b>Peter87</b> (7402)</a></div>
</div>
<div class="dwhat" colspan="2" id="CH_i892187">
Strange, the code compiles fine when I add the includes.<br>
<br>
<div class="auto"><table class="snippet"><tr><td class="rownum"><pre><code>1<br>2<br>3<br></code></pre></td>
<td class="source"><pre><code><dfn>#include &lt;unordered_map&gt;</dfn>
<dfn>#include &lt;memory&gt;</dfn>
<dfn>#include &lt;string&gt; </dfn></code></pre></td><td class="C_btnholder"></td></tr></table></div>
<br>
<br>
Maybe your version of GCC is too old. It compiles fine in GCC 4.9.2. But that doesn't really explain why it works in main but not here. Are you sure this is the first error message in the list?
</div>
<div class="dhow">
<span class="dbtn" id="CH_btn892187"></span>

</div>
</div>
</div>
<div class="C_forPost" id="msg892215"><span title="892215,205503,255,9,0"></span>
<div class="box">
<div class="boxtop">
<div class="dwhen"><a href="#msg892215" title="Link to this post"><img src="/img/link.png" width="16" height="8"></a> <span id="CH_zTmcc1749c227" title="Thu, 31 Dec 2015 15:44:52 +0000"></span><script type="text/javascript">WhenId('CH_zTmcc1749c227');</script><noscript>Dec 31, 2015 at 3:44pm UTC</noscript></div>
<div class="dwho"><a href="/user/Gadersd/"><b>Gadersd</b> (9)</a></div>
</div>
<div class="dwhat" colspan="2" id="CH_i892215">
I just updated GCC to the newest version and I still get these errors. Too many c++ headaches.
</div>
<div class="dhow">
<span class="dbtn" id="CH_btn892215"></span>

</div>
</div>
</div>
<div class="C_forPost" id="msg892216"><span title="892216,205503,255,9,0"></span>
<div class="box">
<div class="boxtop">
<div class="dwhen"><a href="#msg892216" title="Link to this post"><img src="/img/link.png" width="16" height="8"></a> <span id="CH_zTmeab161af26" title="Thu, 31 Dec 2015 15:53:23 +0000"></span><script type="text/javascript">WhenId('CH_zTmeab161af26');</script><noscript>Dec 31, 2015 at 3:53pm UTC</noscript></div>
<div class="dwho"><a href="/user/Gadersd/"><b>Gadersd</b> (9)</a></div>
</div>
<div class="dwhat" colspan="2" id="CH_i892216">
Not surprisingly, this compiles<br>
<div class="auto"><table class="snippet"><tr><td class="rownum"><pre><code>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br></code></pre></td>
<td class="source"><pre><code><var>class</var> St
{
    <var>public</var>:
        St(){}

    <var>protected</var>:
    <var>private</var>:
        std::unordered_map&lt;std::string,std::unique_ptr&lt;<var>int</var>&gt;&gt; objects;
};


<var>class</var> State
{
    <var>public</var>:
        State(){}

    <var>protected</var>:
    <var>private</var>:
        <cite>//std::unordered_map&lt;std::string,std::unique_ptr&lt;int&gt;&gt; objects;</cite>
};</code></pre></td><td class="C_btnholder"></td></tr></table></div>
<br>
<br>
This is by far the strangest thing I have experienced.
</div>
<div class="dhow">
<span class="sedited">Last edited on <span id="CH_zTmf3350d5453" title="Thu, 31 Dec 2015 15:54:57 +0000"></span><script type="text/javascript">WhenId('CH_zTmf3350d5453');</script><noscript>Dec 31, 2015 at 3:54pm UTC</noscript></span>
<span class="dbtn" id="CH_btn892216"></span>

</div>
</div>
</div>
<div class="C_forPost" id="msg892220"><span title="892220,72446,1023,7402,0"></span>
<div class="box">
<div class="boxtop">
<div class="dwhen"><a href="#msg892220" title="Link to this post"><img src="/img/link.png" width="16" height="8"></a> <span id="CH_zTm5d5d20fc0d" title="Thu, 31 Dec 2015 16:06:31 +0000"></span><script type="text/javascript">WhenId('CH_zTm5d5d20fc0d');</script><noscript>Dec 31, 2015 at 4:06pm UTC</noscript></div>
<div class="dwho"><a href="/user/Peter87/"><b>Peter87</b> (7402)</a></div>
</div>
<div class="dwhat" colspan="2" id="CH_i892220">
Are you by any chance trying to copy a State object anywhere in your program? It will not work because std::unique_ptr is not copyable. To make it work you would have to implement your own copy constructor/copy assignment operator for the State class, or find a way to avoid the copying from taking place.
</div>
<div class="dhow">
<span class="sedited">Last edited on <span id="CH_zTm4af17d812a" title="Thu, 31 Dec 2015 16:09:23 +0000"></span><script type="text/javascript">WhenId('CH_zTm4af17d812a');</script><noscript>Dec 31, 2015 at 4:09pm UTC</noscript></span>
<span class="dbtn" id="CH_btn892220"></span>

</div>
</div>
</div>
<div class="C_forPost" id="msg892222"><span title="892222,205503,255,9,0"></span>
<div class="box">
<div class="boxtop">
<div class="dwhen"><a href="#msg892222" title="Link to this post"><img src="/img/link.png" width="16" height="8"></a> <span id="CH_zTmcf7ea30b07" title="Thu, 31 Dec 2015 16:28:05 +0000"></span><script type="text/javascript">WhenId('CH_zTmcf7ea30b07');</script><noscript>Dec 31, 2015 at 4:28pm UTC</noscript></div>
<div class="dwho"><a href="/user/Gadersd/"><b>Gadersd</b> (9)</a></div>
</div>
<div class="dwhat" colspan="2" id="CH_i892222">
You're right. I just found a line where a State is being copied. Time to fix.
</div>
<div class="dhow">
<span class="dbtn" id="CH_btn892222"></span>

</div>
</div>
</div>
<div class="C_forPost" id="msg892224"><span title="892224,78419,1023,7174,0"></span>
<div class="box">
<div class="boxtop">
<div class="dwhen"><a href="#msg892224" title="Link to this post"><img src="/img/link.png" width="16" height="8"></a> <span id="CH_zTmcee1386114" title="Thu, 31 Dec 2015 16:35:02 +0000"></span><script type="text/javascript">WhenId('CH_zTmcee1386114');</script><noscript>Dec 31, 2015 at 4:35pm UTC</noscript></div>
<div class="dwho"><a href="/user/cire/"><b>cire</b> (7174)</a></div>
</div>
<div class="dwhat" colspan="2" id="CH_i892224">
<table class="quote"><tr><td class="qd">You're right. I just found a line where a State is being copied. Time to fix. </td></tr></table><br>
If your unique_ptr is pointing to a single int, store an int directly instead.  If your unique_ptr is pointing to an array, use a container instead.  I'm at a loss as to why one would decide to use unique_ptr here.
</div>
<div class="dhow">
<span class="dbtn" id="CH_btn892224"></span>

</div>
</div>
</div>
<div class="C_forPost" id="msg892252"><span title="892252,205503,255,9,0"></span>
<div class="box">
<div class="boxtop">
<div class="dwhen"><a href="#msg892252" title="Link to this post"><img src="/img/link.png" width="16" height="8"></a> <span id="CH_zTm58b6262c4a" title="Thu, 31 Dec 2015 21:13:16 +0000"></span><script type="text/javascript">WhenId('CH_zTm58b6262c4a');</script><noscript>Dec 31, 2015 at 9:13pm UTC</noscript></div>
<div class="dwho"><a href="/user/Gadersd/"><b>Gadersd</b> (9)</a></div>
</div>
<div class="dwhat" colspan="2" id="CH_i892252">
Actually, the int type is just a placeholder. It was originally of type Object, but I changed it to make the example simpler.
</div>
<div class="dhow">
<span class="dbtn" id="CH_btn892252"></span>

</div>
</div>
</div>
</div><div class="rootinsMore"></div><div class="rootbtnMore"></div><div class="rootinsNew"></div><div class="rootbtnNew"></div><div id="CH_insNew"></div><div id="CH_reply">Topic archived. No new replies allowed.</div><div id="CH_subscription"></div><div class="rootedtNew"></div><script type="text/javascript">new for_PostList(181974,1,205503,1,'CH_PostList','CH_subscription','CH_reply','CH_insNew','CH_edttl','/forum/thread.cgi','/forum/post.cgi','/forum/myposts.cgi',64,32,512,256,1024,16);</script></div>
<script type="text/javascript">
    google_ad_client = "ca-pub-1444228343479937";
    google_ad_slot = "9701143201";
    google_ad_width = 728;
    google_ad_height = 90;
</script>
<!-- leaderboard -->
<script type="text/javascript"
src="//pagead2.googlesyndication.com/pagead/show_ads.js">
</script></div>
<div id="I_nav">
<div class="sect root">
<h3><b><a href="/">C++</a></b></h3>
<ul>
<li class="folder info"><a href="/info/">Information</a></li>
<li class="folder doc"><a href="/doc/">Tutorials</a></li>
<li class="folder reference"><a href="/reference/">Reference</a></li>
<li class="folder articles"><a href="/articles/">Articles</a></li>
<li class="folder selected forum"><a href="/forum/">Forum</a></li>
</ul>
</div>
<div class="sect">
<h3><b><a href="/forum/">Forum</a></b></h3>
<ul>
<li><a href="/forum/beginner/"><b>Beginners</b></a></li><li><a href="/forum/windows/"><b>Windows Programming</b></a></li><li><a href="/forum/unices/"><b>UNIX/Linux Programming</b></a></li><li class="selected"><a href="/forum/general/"><b>General C++ Programming</b></a></li><li><a href="/forum/lounge/"><b>Lounge</b></a></li><li><a href="/forum/jobs/"><b>Jobs</b></a></li></ul>
</div>
<div id="I_subnav"></div>
<div class="C_ad234">
<script type="text/javascript"><!--
google_ad_client = "ca-pub-7688470879129516";
google_ad_slot = "7445514729";
google_ad_width = 234;
google_ad_height = 60;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</div></div>
<div id="I_midclear"></div>
</div>
</div>
<div id="I_bottom">
<div id="I_footer">
	<a href="/">Home page</a> | <a href="/privacy.do">Privacy policy</a><br>&copy; cplusplus.com, 2000-2016 - All rights reserved - <i>v3.1</i><br><a href="/contact.do?referrer=www.cplusplus.com%2Fforum%2Fgeneral%2F181974%2F">Spotted an error? contact us</a>
</div>
</div>

<script type="text/javascript">
<!--
function NavFor(us) {document.getElementById('I_subnav').innerHTML=us.ok?'<div class="sect"><h3><b><a href="/user/">'+us.user+'</a></b></h3><ul><li><a href="/forum/myposts.cgi">My topics</a></li></ul></div>':'';}onSession(NavFor);ready();
var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-521783-1']);
_gaq.push(['_trackPageview']);

(function() {
  var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
  ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
  var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();

//-->
</script>

</body>
</html>