<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Dependency injection std::shared_ptr vs  - C++ Forum</title>
<link rel="shortcut icon" type="image/x-icon" href="/favicon.ico">
<link rel="stylesheet" type="text/css" href="/v321/main.css">
<script src="/v321/main.js" type="text/javascript"></script>
<script type='text/javascript'>
var googletag = googletag || {};
googletag.cmd = googletag.cmd || [];
(function() {
var gads = document.createElement('script');
gads.async = true;
gads.type = 'text/javascript';
var useSSL = 'https:' == document.location.protocol;
gads.src = (useSSL ? 'https:' : 'http:') + 
'//www.googletagservices.com/tag/js/gpt.js';
var node = document.getElementsByTagName('script')[0];
node.parentNode.insertBefore(gads, node);
})();
</script>

<script type='text/javascript'>
googletag.cmd.push(function() {
googletag.defineSlot('/32882001/L', [728, 90], 'div-gpt-ad-1427191279638-0').addService(googletag.pubads());
googletag.enableServices();
});
</script>
</head>
<body>
<div id="I_top">
<div id="I_header">
<div id="I_logo"><a href="/" title="cplusplus.com"><div></div></a></div>
<div id="I_search">
<form id="search" action="/search.do" method="get">
Search: <input name="q" size="20" class="txt"> <input type="submit" value="Go" class="btn">
</form>
</div>
<div id="I_bar">
<ul>
<li><a href="/forum/">Forum</a></li>
<li><a href="/forum/general/">General C++ Programming</a></li>
<li class="here">Dependency injection std::shared_ptr vs </li>
</ul>
</div>
<div id="I_user" class="C_LoginBox"><span title="ajax"></span></div>
</div>
</div>
<div id="I_mid">
<div id="I_wrap">
<div id="I_minheight"></div>
<div id="I_main">
<div class="C_support">
<div id='div-gpt-ad-1427191279638-0' style='width:728px; height:90px;'>
<script type='text/javascript'>
googletag.cmd.push(function() { googletag.display('div-gpt-ad-1427191279638-0'); });
</script>
</div>
</div>
<div id="I_content">
<h3><div class="C_ico question" title="question">&nbsp;</div> Dependency injection std::shared_ptr vs reference</h3><span id="CH_edttl"></span><span class="rootdatPost" title="164361,root,0,-1,7,0"></span><div id="CH_PostList"><div class="C_forPost" id="msg831364"><span title="831364,104249,1023,149,1"></span>
<div class="box">
<div class="boxtop">
<div class="dwhen"><a href="#msg831364" title="Link to this post"><img src="/img/link.png" width="16" height="8"></a> <span id="CH_zTmf203ae6f0d" title="Wed, 06 May 2015 09:36:29 +0000"></span><script type="text/javascript">WhenId('CH_zTmf203ae6f0d');</script><noscript>May 6, 2015 at 9:36am UTC</noscript></div>
<div class="dwho"><a href="/user/benbalach/"><b>benbalach</b> (149)</a></div>
</div>
<div class="dwhat" colspan="2" id="CH_i831364">
Let's say we have a class <span class="auto"><code class="source">Buffer</code></span>, a class <span class="auto"><code class="source">BufferAnalyzer</code></span>, and a glue class <span class="auto"><code class="source">Application</code></span>. Class <span class="auto"><code class="source">Application</code></span> has an instance of <span class="auto"><code class="source">Buffer</code></span> and <span class="auto"><code class="source">BufferAnalyzer</code></span> in it. <span class="auto"><code class="source">BufferAnalyzer</code></span>'s has an object of type <span class="auto"><code class="source">Buffer</code></span> in it.<br>
<br>
My question is should <span class="auto"><code class="source">BufferAnalyzer</code></span> contain a reference to <span class="auto"><code class="source">Buffer</code></span> (this is the style that I've seen in "Programming -- Principles and Practise Using C++" by Bjarne Stroustrup in the code examples) or should it contain a std::shared_ptr (which would decouple the code making classes more reusable)?<br>
<br>
<u>Pros of using a reference:</u><br>
We know that <span class="auto"><code class="source">Application</code></span> controls the life of both <span class="auto"><code class="source">Buffer</code></span> and <span class="auto"><code class="source">BufferAnalyzer</code></span>.<br>
<br>
<u>Cons of using a reference:</u><br>
Classes are tightly coupled and cannot be reused directly without modification.<br>
<br>
<u>Pros of using a std::shared_ptr:</u><br>
Loosely coupled design making classes very resuable.<br>
<br>
<u>Cons of using a std::shared_ptr:</u><br>
I really haven't seen std::shared_ptr used anywhere. All the code that I have seen uses references. In my opinion in C++ it just feels natural to use a reference.
</div>
<div class="dhow">
<span class="sedited">Last edited on <span id="CH_zTm3a78cad15c" title="Wed, 06 May 2015 09:47:30 +0000"></span><script type="text/javascript">WhenId('CH_zTm3a78cad15c');</script><noscript>May 6, 2015 at 9:47am UTC</noscript></span>
<span class="dbtn" id="CH_btn831364"></span>

</div>
</div>
</div>
<div class="C_forPost" id="msg831414"><span title="831414,78419,1023,7174,0"></span>
<div class="box">
<div class="boxtop">
<div class="dwhen"><a href="#msg831414" title="Link to this post"><img src="/img/link.png" width="16" height="8"></a> <span id="CH_zTmb9ce439b8d" title="Wed, 06 May 2015 13:16:15 +0000"></span><script type="text/javascript">WhenId('CH_zTmb9ce439b8d');</script><noscript>May 6, 2015 at 1:16pm UTC</noscript></div>
<div class="dwho"><a href="/user/cire/"><b>cire</b> (7174)</a></div>
</div>
<div class="dwhat" colspan="2" id="CH_i831414">
What makes you think classes are more tightly coupled when using a reference than when using a smart pointer?
</div>
<div class="dhow">
<span class="dbtn" id="CH_btn831414"></span>

</div>
</div>
</div>
<div class="C_forPost" id="msg831427"><span title="831427,104249,1023,149,0"></span>
<div class="box">
<div class="boxtop">
<div class="dwhen"><a href="#msg831427" title="Link to this post"><img src="/img/link.png" width="16" height="8"></a> <span id="CH_zTm09f1590f47" title="Wed, 06 May 2015 14:19:39 +0000"></span><script type="text/javascript">WhenId('CH_zTm09f1590f47');</script><noscript>May 6, 2015 at 2:19pm UTC</noscript></div>
<div class="dwho"><a href="/user/benbalach/"><b>benbalach</b> (149)</a></div>
</div>
<div class="dwhat" colspan="2" id="CH_i831427">
If you use a reference you have to make sure that <span class="auto"><code class="source">Buffer</code></span> does not go out of scope while <span class="auto"><code class="source">BufferAnalyzer</code></span> is still using it. My colleagues said that I should use a std::shared_ptr for that reason, but I still disagree with them and prefer to use a reference. So I wanted a second opinion.
</div>
<div class="dhow">
<span class="sedited">Last edited on <span id="CH_zTm074d3fc13a" title="Wed, 06 May 2015 14:20:16 +0000"></span><script type="text/javascript">WhenId('CH_zTm074d3fc13a');</script><noscript>May 6, 2015 at 2:20pm UTC</noscript></span>
<span class="dbtn" id="CH_btn831427"></span>

</div>
</div>
</div>
<div class="C_forPost" id="msg831550"><span title="831550,11526,1023,1182,0"></span>
<div class="box">
<div class="boxtop">
<div class="dwhen"><a href="#msg831550" title="Link to this post"><img src="/img/link.png" width="16" height="8"></a> <span id="CH_zTm684e439827" title="Wed, 06 May 2015 22:20:21 +0000"></span><script type="text/javascript">WhenId('CH_zTm684e439827');</script><noscript>May 6, 2015 at 10:20pm UTC</noscript></div>
<div class="dwho"><a href="/user/kempofighter/"><b>kempofighter</b> (1182)</a></div>
</div>
<div class="dwhat" colspan="2" id="CH_i831550">
I see no issue with reusability either way.  The advantage of pointers is the ability to decouple dependencies so that you can use forward references in header files.  There is a decoupling advantage of pointers but I don't see how it has anything to do with whether something is more or less reusable.  In implementation is either reusable or it isn't regardless of whether the user of it has a pointer or a reference to it.  In large scale projects this is critical as you can reduce compile times and allow development to interfaces.  In that sense, I generally prefer the pimpl idiom ( <a href="http://en.wikipedia.org/wiki/Opaque_pointer">http://en.wikipedia.org/wiki/Opaque_pointer</a> ) for that advantage.  Additionally some patterns are much easier and better to implement with pointers to implementations.  I rarely if ever use references as class attributes.
</div>
<div class="dhow">
<span class="dbtn" id="CH_btn831550"></span>

</div>
</div>
</div>
<div class="C_forPost" id="msg831584"><span title="831584,78419,1023,7174,0"></span>
<div class="box">
<div class="boxtop">
<div class="dwhen"><a href="#msg831584" title="Link to this post"><img src="/img/link.png" width="16" height="8"></a> <span id="CH_zTm3d80f1d4a6" title="Thu, 07 May 2015 04:36:49 +0000"></span><script type="text/javascript">WhenId('CH_zTm3d80f1d4a6');</script><noscript>May 7, 2015 at 4:36am UTC</noscript></div>
<div class="dwho"><a href="/user/cire/"><b>cire</b> (7174)</a></div>
</div>
<div class="dwhat" colspan="2" id="CH_i831584">
<table class="quote"><tr><td class="qd">If you use a reference you have to make sure that Buffer does not go out of scope while BufferAnalyzer is still using it.</td></tr></table><br>
That's true.<br>
<br>
<table class="quote"><tr><td class="qd">My colleagues said that I should use a std::shared_ptr for that reason, but I still disagree with them and prefer to use a reference.</td></tr></table><br>
I don't see a reason for using a shared pointer.  In this case it's pretty clear the ownership of the object belongs to the Application class, which can ensure the buffer exists when the analyzer is active.  Shared pointers are great for shared ownership, but I don't see a reason for ownership to be shared here.  In fact, requiring the analyzer to share ownership results in less reusability.  You must jump through hoops to use a buffer of automatic duration if shared ownership is required by the analyzer.<br>
<br>
<br>
<table class="quote"><tr><th class="qh"><strong>kempofighter</strong> wrote:</th></tr><tr><td class="qd">The advantage of pointers is the ability to decouple dependencies so that you can use forward references in header files.</td></tr></table><br>
References and pointers are alike in this particular fashion.<br>
<br>
<br>

</div>
<div class="dhow">
<span class="dbtn" id="CH_btn831584"></span>

</div>
</div>
</div>
<div class="C_forPost" id="msg831709"><span title="831709,11526,1023,1182,0"></span>
<div class="box">
<div class="boxtop">
<div class="dwhen"><a href="#msg831709" title="Link to this post"><img src="/img/link.png" width="16" height="8"></a> <span id="CH_zTm0d0447d571" title="Thu, 07 May 2015 16:17:21 +0000"></span><script type="text/javascript">WhenId('CH_zTm0d0447d571');</script><noscript>May 7, 2015 at 4:17pm UTC</noscript></div>
<div class="dwho"><a href="/user/kempofighter/"><b>kempofighter</b> (1182)</a></div>
</div>
<div class="dwhat" colspan="2" id="CH_i831709">
<span class="auto"><code class="source">References and pointers are alike in <var>this</var> particular fashion.</code></span><br>
<br>
I stand corrected on that point.  Thanks.    As I remember; references have to be initialized to something which can't be null which is advantageous in some cases, whereas pointers can be initialized as null and assigned at some later time.  After trying an example, I remember now why  I don't like references as class attributes.  Evidently they have to be initialized in the initializer list which doesn't allow for any flexibility.  It can't be done in the body of the constructor or in a common initialize function that could be called by multiple constructors.  Therefore using a reference is quite tricky or impossible if you are implementing a pattern such as bridge or abstract factory or in any situation where you need to defer the assignment of an object pointer.  I think that references in API calls are great, but as class attributes they always seem to just limit what is possible.
</div>
<div class="dhow">
<span class="sedited">Last edited on <span id="CH_zTm523d3d7b6d" title="Thu, 07 May 2015 16:33:34 +0000"></span><script type="text/javascript">WhenId('CH_zTm523d3d7b6d');</script><noscript>May 7, 2015 at 4:33pm UTC</noscript></span>
<span class="dbtn" id="CH_btn831709"></span>

</div>
</div>
</div>
<div class="C_forPost" id="msg831764"><span title="831764,104249,1023,149,0"></span>
<div class="box">
<div class="boxtop">
<div class="dwhen"><a href="#msg831764" title="Link to this post"><img src="/img/link.png" width="16" height="8"></a> <span id="CH_zTmcb46de7d80" title="Thu, 07 May 2015 20:57:16 +0000"></span><script type="text/javascript">WhenId('CH_zTmcb46de7d80');</script><noscript>May 7, 2015 at 8:57pm UTC</noscript></div>
<div class="dwho"><a href="/user/benbalach/"><b>benbalach</b> (149)</a></div>
</div>
<div class="dwhat" colspan="2" id="CH_i831764">
In fact the more I think about it the more using a reference seems like the right thing to do. The life of <span class="auto"><code class="source">Buffer</code></span> clearly depends on the life of <span class="auto"><code class="source">Application</code></span>, using a std::shared_ptr and allocating on the free store seems absolutely redundant in this case. Someone someday might take class <span class="auto"><code class="source">BufferAnalyzer</code></span> and see that it takes a std::shared_ptr and be like: what's going on here, why do I need to share ownership, what's <span class="auto"><code class="source">BufferAnalyzer</code></span> going to do that it need to share ownership? Where as if you use a reference you keep the interface (of the constructor) simple and straight forward to the users of that class without overcomplicating things unnecessarily. One of the core things I learned of the book "Programming" by Stroustrup is to keep things simple, as simple as possible, but not simpler. The people I worked with on that project were working with Java mainly and apparently they wanted to put the philosophy of that language in C++. In this case why do you have to do your own memory management (using smart pointers and allocating on the free store) when you can use the stack and RAII (thus keeping it simple)? And also no design patterns were used for <span class="auto"><code class="source">Buffer</code></span>, <span class="auto"><code class="source">BufferAnalyzer</code></span>, and <span class="auto"><code class="source">Application</code></span> so using a reference limits the possibility to swap one implementation with another at runtime as it should be because that is the logic of the program.<br>
<br>
Side note: We completed the project a long time ago and used std::shared_ptr, but this dilemma was still bothering me inside, whether to use a std::shared_ptr or a reference.
</div>
<div class="dhow">
<span class="sedited">Last edited on <span id="CH_zTm9f1f6f9981" title="Fri, 08 May 2015 06:15:59 +0000"></span><script type="text/javascript">WhenId('CH_zTm9f1f6f9981');</script><noscript>May 8, 2015 at 6:15am UTC</noscript></span>
<span class="dbtn" id="CH_btn831764"></span>

</div>
</div>
</div>
</div><div class="rootinsMore"></div><div class="rootbtnMore"></div><div class="rootinsNew"></div><div class="rootbtnNew"></div><div id="CH_insNew"></div><div id="CH_reply">Topic archived. No new replies allowed.</div><div id="CH_subscription"></div><div class="rootedtNew"></div><script type="text/javascript">new for_PostList(164361,1,104249,0,'CH_PostList','CH_subscription','CH_reply','CH_insNew','CH_edttl','/forum/thread.cgi','/forum/post.cgi','/forum/myposts.cgi',64,32,512,256,1024,16);</script></div>
<script type="text/javascript">
    google_ad_client = "ca-pub-1444228343479937";
    google_ad_slot = "9701143201";
    google_ad_width = 728;
    google_ad_height = 90;
</script>
<!-- leaderboard -->
<script type="text/javascript"
src="//pagead2.googlesyndication.com/pagead/show_ads.js">
</script></div>
<div id="I_nav">
<div class="sect root">
<h3><b><a href="/">C++</a></b></h3>
<ul>
<li class="folder info"><a href="/info/">Information</a></li>
<li class="folder doc"><a href="/doc/">Tutorials</a></li>
<li class="folder reference"><a href="/reference/">Reference</a></li>
<li class="folder articles"><a href="/articles/">Articles</a></li>
<li class="folder selected forum"><a href="/forum/">Forum</a></li>
</ul>
</div>
<div class="sect">
<h3><b><a href="/forum/">Forum</a></b></h3>
<ul>
<li><a href="/forum/beginner/"><b>Beginners</b></a></li><li><a href="/forum/windows/"><b>Windows Programming</b></a></li><li><a href="/forum/unices/"><b>UNIX/Linux Programming</b></a></li><li class="selected"><a href="/forum/general/"><b>General C++ Programming</b></a></li><li><a href="/forum/lounge/"><b>Lounge</b></a></li><li><a href="/forum/jobs/"><b>Jobs</b></a></li></ul>
</div>
<div id="I_subnav"></div>
<div class="C_ad234">
<script type="text/javascript"><!--
google_ad_client = "ca-pub-7688470879129516";
google_ad_slot = "7445514729";
google_ad_width = 234;
google_ad_height = 60;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</div></div>
<div id="I_midclear"></div>
</div>
</div>
<div id="I_bottom">
<div id="I_footer">
	<a href="/">Home page</a> | <a href="/privacy.do">Privacy policy</a><br>&copy; cplusplus.com, 2000-2016 - All rights reserved - <i>v3.1</i><br><a href="/contact.do?referrer=www.cplusplus.com%2Fforum%2Fgeneral%2F164361%2F">Spotted an error? contact us</a>
</div>
</div>

<script type="text/javascript">
<!--
function NavFor(us) {document.getElementById('I_subnav').innerHTML=us.ok?'<div class="sect"><h3><b><a href="/user/">'+us.user+'</a></b></h3><ul><li><a href="/forum/myposts.cgi">My topics</a></li></ul></div>':'';}onSession(NavFor);ready();
var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-521783-1']);
_gaq.push(['_trackPageview']);

(function() {
  var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
  ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
  var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();

//-->
</script>

</body>
</html>