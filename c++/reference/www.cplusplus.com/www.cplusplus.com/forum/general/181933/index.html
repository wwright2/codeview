<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Why this behavior? - C++ Forum</title>
<link rel="shortcut icon" type="image/x-icon" href="/favicon.ico">
<link rel="stylesheet" type="text/css" href="/v321/main.css">
<script src="/v321/main.js" type="text/javascript"></script>
<script type='text/javascript'>
var googletag = googletag || {};
googletag.cmd = googletag.cmd || [];
(function() {
var gads = document.createElement('script');
gads.async = true;
gads.type = 'text/javascript';
var useSSL = 'https:' == document.location.protocol;
gads.src = (useSSL ? 'https:' : 'http:') + 
'//www.googletagservices.com/tag/js/gpt.js';
var node = document.getElementsByTagName('script')[0];
node.parentNode.insertBefore(gads, node);
})();
</script>

<script type='text/javascript'>
googletag.cmd.push(function() {
googletag.defineSlot('/32882001/L', [728, 90], 'div-gpt-ad-1427191279638-0').addService(googletag.pubads());
googletag.enableServices();
});
</script>
</head>
<body>
<div id="I_top">
<div id="I_header">
<div id="I_logo"><a href="/" title="cplusplus.com"><div></div></a></div>
<div id="I_search">
<form id="search" action="/search.do" method="get">
Search: <input name="q" size="20" class="txt"> <input type="submit" value="Go" class="btn">
</form>
</div>
<div id="I_bar">
<ul>
<li><a href="/forum/">Forum</a></li>
<li><a href="/forum/general/">General C++ Programming</a></li>
<li class="here">Why this behavior?</li>
</ul>
</div>
<div id="I_user" class="C_LoginBox"><span title="ajax"></span></div>
</div>
</div>
<div id="I_mid">
<div id="I_wrap">
<div id="I_minheight"></div>
<div id="I_main">
<div class="C_support">
<div id='div-gpt-ad-1427191279638-0' style='width:728px; height:90px;'>
<script type='text/javascript'>
googletag.cmd.push(function() { googletag.display('div-gpt-ad-1427191279638-0'); });
</script>
</div>
</div>
<div id="I_content">
<h3><div class="C_ico default" title="post">&nbsp;</div> Why this behavior?</h3><span id="CH_edttl"></span><span class="rootdatPost" title="181933,root,0,-1,7,0"></span><div id="CH_PostList"><div class="C_forPost" id="msg891986"><span title="891986,114297,1023,120,1"></span>
<div class="box">
<div class="boxtop">
<div class="dwhen"><a href="#msg891986" title="Link to this post"><img src="/img/link.png" width="16" height="8"></a> <span id="CH_zTm969ebb83a0" title="Wed, 30 Dec 2015 03:27:00 +0000"></span><script type="text/javascript">WhenId('CH_zTm969ebb83a0');</script><noscript>Dec 30, 2015 at 3:27am UTC</noscript></div>
<div class="dwho"><a href="/user/geeloso/"><b>geeloso</b> (120)</a></div>
</div>
<div class="dwhat" colspan="2" id="CH_i891986">
Hey guys! I have a struct template <b>nodeType</b> and a class template <b>nodeType</b> as shown below and I have shown the simple definition of the member function <b>nodeType::getInfo()</b>: <br>
<br>
<br>
<div class="auto"><table class="snippet"><tr><td class="rownum"><pre><code>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26<br>27<br>28<br>29<br>30<br>31<br>32<br>33<br></code></pre></td>
<td class="source"><pre><code><var>template</var>&lt;<var>class</var> elemType&gt;
<var>struct</var> nodeType                           <cite>//structure of the node</cite>
{
    elemType info;
    nodeType&lt;elemType&gt; *link;
};


<var>template</var>&lt;<var>class</var> elemType&gt;
<var>class</var> nodeType                       <cite>//structure of the node                                                                                                                                                                             </cite>
{
<var>public</var>:
	<var>const</var> nodeType&lt;elemType&gt;&amp; <var>operator</var>=(<var>const</var> nodeType&lt;elemType&gt;&amp;);
        <var>void</var> setInfo(<var>const</var> elemType&amp; elem);
	elemType getInfo() <var>const</var>;
	<var>void</var> setLink(nodeType&lt;elemType&gt;* ptr);
	nodeType&lt;elemType&gt;* getLink() <var>const</var>;
	nodeType();
	nodeType(<var>const</var> elemType&amp; elem, nodeType&lt;elemType&gt;* ptr);
	nodeType(<var>const</var> nodeType&lt;elemType&gt;&amp; otherNode);
	~nodeType();
	
<var>private</var>:
	elemType info;
	nodeType&lt;elemType&gt;* link;
};


elemType nodeType&lt;elemType&gt;::getInfo() <var>const</var>
{
	<var>return</var> info;
}
</code></pre></td><td class="C_btnholder"></td></tr></table></div>
<br>
<br>
<br>
Consider the two member functions of another class (a class template <b>linkedListType&lt;elemType&gt;</b>) as shown below. While the two functions are used in two <b>different</b> programs, they are pretty much the same <b>except</b> for <span class="auto"><code class="source">lines 16 and 39</code></span> and, more importantly, the first function uses the struct template while the second function uses the class template above.<br>
<br>
<div class="auto"><table class="snippet"><tr><td class="rownum"><pre><code>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26<br>27<br>28<br>29<br>30<br>31<br>32<br>33<br>34<br>35<br>36<br>37<br>38<br>39<br>40<br>41<br>42<br>43<br></code></pre></td>
<td class="source"><pre><code><var>const</var> elemType&amp; linkedListType&lt;elemType&gt;::kthElement(<var>int</var> k)
{
	<var>int</var> i = 1; 
	
	<var>if</var> (0 &lt; k &amp;&amp; k &lt;= count)
	{	
		nodeType&lt;elemType&gt;* current;
		
		current = first;
		<var>while</var> (i &lt; k)
		{
			current = current-&gt;link;
			i++;
		}
		
		<var>return</var> current-&gt;info;		
	}
	<var>else</var>
		<var>throw</var> k;		<cite>//List does not have k elements!		    </cite>
}



<var>const</var> elemType&amp; linkedListType&lt;elemType&gt;::kthElement(<var>int</var> k)
{
	<var>int</var> i = 1; 
	
	<var>if</var> (0 &lt; k &amp;&amp; k &lt;= count)
	{	
		nodeType&lt;elemType&gt;* current;
		
		current = first;
		<var>while</var> (i &lt; k)
		{
			current = current-&gt;link;
			i++;
		}
		
		<var>return</var> current-&gt;getInfo();		
	}
	<var>else</var>
		<var>throw</var> k;		<cite>//List does not have k elements!		    </cite>
}</code></pre></td><td class="C_btnholder"></td></tr></table></div>
<br>
<br>
<br>
<b>My question is</b>: <br>
<i>Why does the first function work fine and the second doesn't??! </i><br>
<br>
I got a compiler error about the second function that states <br>
<div class="auto"><table class="snippet"><tr><td class="output"><pre><samp>[Warning] returning reference to temporary</samp></pre></td></tr></table></div><br>
<br>

</div>
<div class="dhow">
<span class="sedited">Last edited on <span id="CH_zTm07647abff5" title="Wed, 30 Dec 2015 04:24:51 +0000"></span><script type="text/javascript">WhenId('CH_zTm07647abff5');</script><noscript>Dec 30, 2015 at 4:24am UTC</noscript></span>
<span class="dbtn" id="CH_btn891986"></span>

</div>
</div>
</div>
<div class="C_forPost" id="msg892000"><span title="892000,75536,1023,7545,-1"></span>
<div class="box reported">
<div class="boxtop">
<div class="dwhen"><a href="#msg892000" title="Link to this post"><img src="/img/link.png" width="16" height="8"></a> <span id="CH_zTmf3100a8273" title="Wed, 30 Dec 2015 04:44:34 +0000"></span><script type="text/javascript">WhenId('CH_zTmf3100a8273');</script><noscript>Dec 30, 2015 at 4:44am UTC</noscript></div>
<div class="dwho"><a href="/user/JLBorges/"><b>JLBorges</b> (7545)</a></div>
</div>
<div class="dwhat" colspan="2" id="CH_i892000">
<tt><b>elemType</b> nodeType::elemType getInfo() const;</tt> <br>
returns an anonymous temporary object (a <i>prvalue</i>); a copy of the object in the node. <br>
The life-time of the temporary object is limited.<br>
<br>
Make it return a reference to const to the object in the node (return an <i>lvalue</i>) :<br>
<tt><b>const elemType&amp;</b> nodeType::elemType getInfo() const;</tt> 
</div>
<div class="dhow">
<span class="dbtn" id="CH_btn892000"></span>

</div>
</div>
</div>
<div class="C_forPost" id="msg892004"><span title="892004,114297,1023,120,0"></span>
<div class="box">
<div class="boxtop">
<div class="dwhen"><a href="#msg892004" title="Link to this post"><img src="/img/link.png" width="16" height="8"></a> <span id="CH_zTmc540e3970d" title="Wed, 30 Dec 2015 05:07:52 +0000"></span><script type="text/javascript">WhenId('CH_zTmc540e3970d');</script><noscript>Dec 30, 2015 at 5:07am UTC</noscript></div>
<div class="dwho"><a href="/user/geeloso/"><b>geeloso</b> (120)</a></div>
</div>
<div class="dwhat" colspan="2" id="CH_i892004">
I cannot change any thing in the specified class definition given in the exercise I am working on! I have control over the linkedListType&lt;elemType&gt; functions though. Is there a way I can work around this?<br>
<br>
<br>
<br>

</div>
<div class="dhow">
<span class="dbtn" id="CH_btn892004"></span>

</div>
</div>
</div>
<div class="C_forPost" id="msg892008"><span title="892008,75536,1023,7545,-1"></span>
<div class="box reported">
<div class="boxtop">
<div class="dwhen"><a href="#msg892008" title="Link to this post"><img src="/img/link.png" width="16" height="8"></a> <span id="CH_zTmbf52313606" title="Wed, 30 Dec 2015 05:42:42 +0000"></span><script type="text/javascript">WhenId('CH_zTmbf52313606');</script><noscript>Dec 30, 2015 at 5:42am UTC</noscript></div>
<div class="dwho"><a href="/user/JLBorges/"><b>JLBorges</b> (7545)</a></div>
</div>
<div class="dwhat" colspan="2" id="CH_i892008">
<div class="auto"><table class="snippet"><tr><td class="rownum"><pre><code>1<br>2<br></code></pre></td>
<td class="source"><pre><code><cite>// <b>const elemType&amp;</b> linkedListType&lt;elemType&gt;::kthElement(int k) { /* ... */ }</cite>
<b>elemType</b> linkedListType&lt;elemType&gt;::kthElement(<var>int</var> k) { <cite>/* ... */</cite> }</code></pre></td><td class="C_btnholder"></td></tr></table></div>
<br>
<br>
<div class="auto"><table class="snippet"><tr><td class="rownum"><pre><code>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br></code></pre></td>
<td class="source"><pre><code>elemType linkedListType&lt;elemType&gt;::kthElement( std::size_t k ) <cite>// first element at position zero</cite>
{
    <var>if</var>( k &lt; count ) <cite>// count is number of elements in the list. valid positions are 0 .. count-1</cite>
    {
        <var>auto</var> current = first ;
        <var>for</var>( std::size_t pos = 0 ; pos &lt; k ; ++pos ) current = current-&gt;link ;
        <var>return</var> current-&gt;getInfo();
    }

    <var>else</var> <var>throw</var> std::out_of_range( <kbd>"linked list: invalid position"</kbd> ) ; <cite>// #include &lt;stdexcept&gt;</cite>
}</code></pre></td><td class="C_btnholder"></td></tr></table></div>

</div>
<div class="dhow">
<span class="sedited">Last edited on <span id="CH_zTm3e9aaa400f" title="Wed, 30 Dec 2015 05:54:46 +0000"></span><script type="text/javascript">WhenId('CH_zTm3e9aaa400f');</script><noscript>Dec 30, 2015 at 5:54am UTC</noscript></span>
<span class="dbtn" id="CH_btn892008"></span>

</div>
</div>
</div>
<div class="C_forPost" id="msg892040"><span title="892040,114297,1023,120,0"></span>
<div class="box">
<div class="boxtop">
<div class="dwhen"><a href="#msg892040" title="Link to this post"><img src="/img/link.png" width="16" height="8"></a> <span id="CH_zTm7e638ede9d" title="Wed, 30 Dec 2015 08:45:11 +0000"></span><script type="text/javascript">WhenId('CH_zTm7e638ede9d');</script><noscript>Dec 30, 2015 at 8:45am UTC</noscript></div>
<div class="dwho"><a href="/user/geeloso/"><b>geeloso</b> (120)</a></div>
</div>
<div class="dwhat" colspan="2" id="CH_i892040">
Thx JLBorges for your coding effort; however, it seems like a trivial solution that just required removing the const reference designation from the function heading. I knew that stripping the function of the const reference specification would solve the problem but, I guess I took a cue from the function prototype for overloading the assignment operator for a class:<br>
<br>
<span class="auto"><code class="source"><var>const</var> classname&amp; classname::opeator=(<var>const</var> classname&amp;);</code></span><br>
<br>
It similarly returns a const reference type (<span class="auto"><code class="source">*<var>this</var></code></span>). While I know this is different from my case, the question I have is:<br>
<i>Is this (i.e. <span class="auto"><code class="source"><var>operator</var>=</code></span>), by and large, the only case where a const reference type is returned by a function?<br>
</i><br>
I would admit I don't think I have fully understood when it is appropriate to return a reference or a const reference from a function! By this I mean how to know exactly when returning just a type, a reference to a type, or a const reference to a type is sufficient/required/mandatory.<br>
<br>
Please let me have any relevant/useful links on the subjects of <b>reference</b> and <b>const reference</b> you may know of.
</div>
<div class="dhow">
<span class="dbtn" id="CH_btn892040"></span>

</div>
</div>
</div>
<div class="C_forPost" id="msg892076"><span title="892076,127909,1023,2072,0"></span>
<div class="box">
<div class="boxtop">
<div class="dwhen"><a href="#msg892076" title="Link to this post"><img src="/img/link.png" width="16" height="8"></a> <span id="CH_zTm9b453368d2" title="Wed, 30 Dec 2015 12:07:32 +0000"></span><script type="text/javascript">WhenId('CH_zTm9b453368d2');</script><noscript>Dec 30, 2015 at 12:07pm UTC</noscript></div>
<div class="dwho"><a href="/user/dhayden/"><b>dhayden</b> (2072)</a></div>
</div>
<div class="dwhat" colspan="2" id="CH_i892076">
<table class="quote"><tr><td class="qd">Is this (i.e. operator=), by and large, the only case where a const reference type is returned by a function?</td></tr></table><br>
No. Another good example is when returning the data part of a linked list node.... :)<br>
<table class="quote"><tr><td class="qd">I cannot change any thing in the specified class definition given in the exercise</td></tr></table><br>
That is unfortunate because it's a VERY bad design to have getInfo() return a copy of the data.  Consider this:<br>
<div class="auto"><table class="snippet"><tr><td class="rownum"><pre><code>1<br>2<br>3<br>4<br>5<br></code></pre></td>
<td class="source"><pre><code><var>struct</var> MyInfo {
    <var>char</var> bigArray[1000000];
};

nodeType&lt;MyInfo&gt; node;</code></pre></td><td class="C_btnholder"></td></tr></table></div>
<br>
<br>
Now each and every time you call <span class="auto"><code class="source">node.getInfo()</code></span>, the compiler is forced to return a copy of the data, which 1MB in size, so every getInfo() call results in copying a megabyte of memory. Icky.
</div>
<div class="dhow">
<span class="dbtn" id="CH_btn892076"></span>

</div>
</div>
</div>
<div class="C_forPost" id="msg892084"><span title="892084,75536,1023,7545,-1"></span>
<div class="box reported">
<div class="boxtop">
<div class="dwhen"><a href="#msg892084" title="Link to this post"><img src="/img/link.png" width="16" height="8"></a> <span id="CH_zTm81f99946e7" title="Wed, 30 Dec 2015 15:09:48 +0000"></span><script type="text/javascript">WhenId('CH_zTm81f99946e7');</script><noscript>Dec 30, 2015 at 3:09pm UTC</noscript></div>
<div class="dwho"><a href="/user/JLBorges/"><b>JLBorges</b> (7545)</a></div>
</div>
<div class="dwhat" colspan="2" id="CH_i892084">
&gt; when returning just a type, a reference to a type, or a const reference to a type is sufficient/required/mandatory.<br>
<br>
In general, favour value semantics; favour pass by value and returning values. <br>
This is particularly true for object-oriented interfaces.<br>
<br>
<div class="auto"><table class="snippet"><tr><td class="rownum"><pre><code>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br></code></pre></td>
<td class="source"><pre><code><var>struct</var> book 
{
     <var>virtual</var> ~book() = <var>default</var> ;
    
     <var>virtual</var> <var>const</var> std::string&amp; title() <var>const</var> = 0 ; <cite>// implementation in disguise</cite>
     
     <var>virtual</var> std::string author() <var>const</var> = 0 ; <cite>// fine: fully encapsulates implementation</cite>
}; </code></pre></td><td class="C_btnholder"></td></tr></table></div>
<br>
<br>
There are situations where value semantics is impossible; for instance, return an object of a  polymorphic type, or pass a non-copyable, non-moveable object.<br>
<br>
Sometimes, passing by reference or returning an object (an <i>lvalue</i> reference) is required; for instance the identity of the object is important.<br>
<br>
Though this has become less common after C++11, we may want to use references in order to avoid the expensive copy of an object. This is usually true in generic code where the type of the object could be anything. <br>
<br>
As far as the <tt>const</tt> qualifier is concerned, on <i>lvalues</i>, use <tt>const</tt> pro-actively - if it can be  <tt>const</tt>, make it <tt>const</tt>. <br>
Avoid const-qualifying <i>prvalues</i>. 
</div>
<div class="dhow">
<span class="dbtn" id="CH_btn892084"></span>

</div>
</div>
</div>
</div><div class="rootinsMore"></div><div class="rootbtnMore"></div><div class="rootinsNew"></div><div class="rootbtnNew"></div><div id="CH_insNew"></div><div id="CH_reply">Topic archived. No new replies allowed.</div><div id="CH_subscription"></div><div class="rootedtNew"></div><script type="text/javascript">new for_PostList(181933,1,114297,0,'CH_PostList','CH_subscription','CH_reply','CH_insNew','CH_edttl','/forum/thread.cgi','/forum/post.cgi','/forum/myposts.cgi',64,32,512,256,1024,16);</script></div>
<script type="text/javascript">
    google_ad_client = "ca-pub-1444228343479937";
    google_ad_slot = "9701143201";
    google_ad_width = 728;
    google_ad_height = 90;
</script>
<!-- leaderboard -->
<script type="text/javascript"
src="//pagead2.googlesyndication.com/pagead/show_ads.js">
</script></div>
<div id="I_nav">
<div class="sect root">
<h3><b><a href="/">C++</a></b></h3>
<ul>
<li class="folder info"><a href="/info/">Information</a></li>
<li class="folder doc"><a href="/doc/">Tutorials</a></li>
<li class="folder reference"><a href="/reference/">Reference</a></li>
<li class="folder articles"><a href="/articles/">Articles</a></li>
<li class="folder selected forum"><a href="/forum/">Forum</a></li>
</ul>
</div>
<div class="sect">
<h3><b><a href="/forum/">Forum</a></b></h3>
<ul>
<li><a href="/forum/beginner/"><b>Beginners</b></a></li><li><a href="/forum/windows/"><b>Windows Programming</b></a></li><li><a href="/forum/unices/"><b>UNIX/Linux Programming</b></a></li><li class="selected"><a href="/forum/general/"><b>General C++ Programming</b></a></li><li><a href="/forum/lounge/"><b>Lounge</b></a></li><li><a href="/forum/jobs/"><b>Jobs</b></a></li></ul>
</div>
<div id="I_subnav"></div>
<div class="C_ad234">
<script type="text/javascript"><!--
google_ad_client = "ca-pub-7688470879129516";
google_ad_slot = "7445514729";
google_ad_width = 234;
google_ad_height = 60;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</div></div>
<div id="I_midclear"></div>
</div>
</div>
<div id="I_bottom">
<div id="I_footer">
	<a href="/">Home page</a> | <a href="/privacy.do">Privacy policy</a><br>&copy; cplusplus.com, 2000-2016 - All rights reserved - <i>v3.1</i><br><a href="/contact.do?referrer=www.cplusplus.com%2Fforum%2Fgeneral%2F181933%2F">Spotted an error? contact us</a>
</div>
</div>

<script type="text/javascript">
<!--
function NavFor(us) {document.getElementById('I_subnav').innerHTML=us.ok?'<div class="sect"><h3><b><a href="/user/">'+us.user+'</a></b></h3><ul><li><a href="/forum/myposts.cgi">My topics</a></li></ul></div>':'';}onSession(NavFor);ready();
var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-521783-1']);
_gaq.push(['_trackPageview']);

(function() {
  var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
  ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
  var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();

//-->
</script>

</body>
</html>