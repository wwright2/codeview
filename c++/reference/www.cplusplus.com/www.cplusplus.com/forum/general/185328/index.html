<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Why does sizeof and _count work on stati - C++ Forum</title>
<link rel="shortcut icon" type="image/x-icon" href="/favicon.ico">
<link rel="stylesheet" type="text/css" href="/v321/main.css">
<script src="/v321/main.js" type="text/javascript"></script>
<script type='text/javascript'>
var googletag = googletag || {};
googletag.cmd = googletag.cmd || [];
(function() {
var gads = document.createElement('script');
gads.async = true;
gads.type = 'text/javascript';
var useSSL = 'https:' == document.location.protocol;
gads.src = (useSSL ? 'https:' : 'http:') + 
'//www.googletagservices.com/tag/js/gpt.js';
var node = document.getElementsByTagName('script')[0];
node.parentNode.insertBefore(gads, node);
})();
</script>

<script type='text/javascript'>
googletag.cmd.push(function() {
googletag.defineSlot('/32882001/L', [728, 90], 'div-gpt-ad-1427191279638-0').addService(googletag.pubads());
googletag.enableServices();
});
</script>
</head>
<body>
<div id="I_top">
<div id="I_header">
<div id="I_logo"><a href="/" title="cplusplus.com"><div></div></a></div>
<div id="I_search">
<form id="search" action="/search.do" method="get">
Search: <input name="q" size="20" class="txt"> <input type="submit" value="Go" class="btn">
</form>
</div>
<div id="I_bar">
<ul>
<li><a href="/forum/">Forum</a></li>
<li><a href="/forum/general/">General C++ Programming</a></li>
<li class="here">Why does sizeof and _count work on stati</li>
</ul>
</div>
<div id="I_user" class="C_LoginBox"><span title="ajax"></span></div>
</div>
</div>
<div id="I_mid">
<div id="I_wrap">
<div id="I_minheight"></div>
<div id="I_main">
<div class="C_support">
<div id='div-gpt-ad-1427191279638-0' style='width:728px; height:90px;'>
<script type='text/javascript'>
googletag.cmd.push(function() { googletag.display('div-gpt-ad-1427191279638-0'); });
</script>
</div>
</div>
<div id="I_content">
<h3><div class="C_ico default" title="post">&nbsp;</div> Why does sizeof and _count work on static array but not dynamic array?</h3><span id="CH_edttl"></span><span class="rootdatPost" title="185328,root,0,-1,3,0"></span><div id="CH_PostList"><div class="C_forPost" id="msg904975"><span title="904975,185358,1023,13,1"></span>
<div class="box">
<div class="boxtop">
<div class="dwhen"><a href="#msg904975" title="Link to this post"><img src="/img/link.png" width="16" height="8"></a> <span id="CH_zTmd419732fec" title="Wed, 24 Feb 2016 14:41:31 +0000"></span><script type="text/javascript">WhenId('CH_zTmd419732fec');</script><noscript>Feb 24, 2016 at 2:41pm UTC</noscript></div>
<div class="dwho"><a href="/user/curiousengineer/"><b>curiousengineer</b> (13)</a></div>
</div>
<div class="dwhat" colspan="2" id="CH_i904975">
I can see that arrays and pointers are fundamentally the same i.e array decomposes to a pointer thus for int x[5], x on its own gives address of x[0] just like if I had used pointer with dynamic memory allocation int *x = new int[5], x on its own would give address of x[0].<br>
<br>
Now, why is it that while sizeof and _count work on static arrays, they do not work on dynamic arrays that are allocated using pointer. This question arises as I am not aware of the internal working of sizeof and _count. I am sure it is possible to have a mechanism within the language whereby the sizeof and count are automatically calculated and stored somewhere when a dynamic memory is allocated but no one has done this yet?<br>
<br>
NB: I meant using sizeof to find sizeof array
</div>
<div class="dhow">
<span class="sedited">Last edited on <span id="CH_zTmb08d026f1e" title="Wed, 24 Feb 2016 14:49:47 +0000"></span><script type="text/javascript">WhenId('CH_zTmb08d026f1e');</script><noscript>Feb 24, 2016 at 2:49pm UTC</noscript></span>
<span class="dbtn" id="CH_btn904975"></span>

</div>
</div>
</div>
<div class="C_forPost" id="msg904981"><span title="904981,97037,1023,1903,0"></span>
<div class="box">
<div class="boxtop">
<div class="dwhen"><a href="#msg904981" title="Link to this post"><img src="/img/link.png" width="16" height="8"></a> <span id="CH_zTmf72015dd92" title="Wed, 24 Feb 2016 15:07:05 +0000"></span><script type="text/javascript">WhenId('CH_zTmf72015dd92');</script><noscript>Feb 24, 2016 at 3:07pm UTC</noscript></div>
<div class="dwho"><a href="/user/jlb/"><b>jlb</b> (1903)</a></div>
</div>
<div class="dwhat" colspan="2" id="CH_i904981">
<table class="quote"><tr><td class="qd">I am sure it is possible to have a mechanism within the language whereby the sizeof and count are automatically calculated and stored somewhere when a dynamic memory is allocated but no one has done this yet?</td></tr></table><br>
<br>
Yes someone has already done this, think std::vector, std::array instead of raw arrays.<br>
<br>
<table class="quote"><tr><td class="qd">I can see that arrays and pointers are fundamentally the same</td></tr></table><br>
There are subtle differences between arrays and pointers. This is what is causing you the problems. You can't use sizeof() to determine the size of the array if you only have a pointer to the array. If you use sizeof() on a pointer you will get the sizeof the pointer, not the size the array.<br>
<br>

</div>
<div class="dhow">
<span class="dbtn" id="CH_btn904981"></span>

</div>
</div>
</div>
<div class="C_forPost" id="msg905012"><span title="905012,111189,1023,4869,0"></span>
<div class="box">
<div class="boxtop">
<div class="dwhen"><a href="#msg905012" title="Link to this post"><img src="/img/link.png" width="16" height="8"></a> <span id="CH_zTm340c5549ae" title="Wed, 24 Feb 2016 17:40:14 +0000"></span><script type="text/javascript">WhenId('CH_zTm340c5549ae');</script><noscript>Feb 24, 2016 at 5:40pm UTC</noscript></div>
<div class="dwho"><a href="/user/keskiverto/"><b>keskiverto</b> (4869)</a></div>
</div>
<div class="dwhat" colspan="2" id="CH_i905012">
<table class="quote"><tr><td class="qd">dynamic arrays that are allocated using pointer.</td></tr></table><br>
Semantically, the allocation does not <i>use</i> a pointer. This is syntactically valid:<br>
int main( int argc, char ** ) {<br>
  new double[argc];<br>
  return 0;<br>
}[/code]<br>
No pointers were used in the above program.<br>
(Side-effect: a memory leak.)<br>
<br>
<br>
The main point of the issue is in the words <b>static</b> and <b>dynamic</b>.<br>
<br>
When the compiler reads a static array declaration, it does memorize the static size and thus whenever that array is referenced, the compiler has the size at its disposal.<br>
<div class="auto"><table class="snippet"><tr><td class="rownum"><pre><code>1<br>2<br></code></pre></td>
<td class="source"><pre><code><var>int</var> foo[42];
<var>int</var> s = <var>sizeof</var>(foo);</code></pre></td><td class="C_btnholder"></td></tr></table></div>
<br>
The compiler can and does evaluate the <span class="auto"><code class="source"><var>sizeof</var>(foo)</code></span> during compilation, because it does have all the components of that constexpr at its disposal.<br>
<br>
The compiler cannot possibly know the size of the unnamed dynamically allocated memory block in my example program.<br>
<br>
A pointer datatype is clearly defined and does not contain space for size info (apart from the type of the pointed to type, which is a static value). For example, a pointer does not know whether the address stored in pointer is of a single value or of an element of some array.<br>
<br>
<br>
Yes, the system that actually allocates memory, does have the size (in order to perform array deallocation and for heap bookkeeping), but there is apparently no way to transfer that knowledge.
</div>
<div class="dhow">
<span class="dbtn" id="CH_btn905012"></span>

</div>
</div>
</div>
</div><div class="rootinsMore"></div><div class="rootbtnMore"></div><div class="rootinsNew"></div><div class="rootbtnNew"></div><div id="CH_insNew"></div><div id="CH_reply">Registered users can post here. <a href="/user/">Sign in or register</a> to post.</div><div id="CH_subscription"></div><div class="rootedtNew"></div><script type="text/javascript">new for_PostList(185328,0,185358,0,'CH_PostList','CH_subscription','CH_reply','CH_insNew','CH_edttl','/forum/thread.cgi','/forum/post.cgi','/forum/myposts.cgi',64,32,512,256,1024,16);</script></div>
</div>
<div id="I_nav">
<div class="sect root">
<h3><b><a href="/">C++</a></b></h3>
<ul>
<li class="folder info"><a href="/info/">Information</a></li>
<li class="folder doc"><a href="/doc/">Tutorials</a></li>
<li class="folder reference"><a href="/reference/">Reference</a></li>
<li class="folder articles"><a href="/articles/">Articles</a></li>
<li class="folder selected forum"><a href="/forum/">Forum</a></li>
</ul>
</div>
<div class="sect">
<h3><b><a href="/forum/">Forum</a></b></h3>
<ul>
<li><a href="/forum/beginner/"><b>Beginners</b></a></li><li><a href="/forum/windows/"><b>Windows Programming</b></a></li><li><a href="/forum/unices/"><b>UNIX/Linux Programming</b></a></li><li class="selected"><a href="/forum/general/"><b>General C++ Programming</b></a></li><li><a href="/forum/lounge/"><b>Lounge</b></a></li><li><a href="/forum/jobs/"><b>Jobs</b></a></li></ul>
</div>
<div id="I_subnav"></div>
<div class="C_ad234">
<script type="text/javascript"><!--
google_ad_client = "ca-pub-7688470879129516";
google_ad_slot = "7445514729";
google_ad_width = 234;
google_ad_height = 60;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</div></div>
<div id="I_midclear"></div>
</div>
</div>
<div id="I_bottom">
<div id="I_footer">
	<a href="/">Home page</a> | <a href="/privacy.do">Privacy policy</a><br>&copy; cplusplus.com, 2000-2016 - All rights reserved - <i>v3.1</i><br><a href="/contact.do?referrer=www.cplusplus.com%2Fforum%2Fgeneral%2F185328%2F">Spotted an error? contact us</a>
</div>
</div>

<script type="text/javascript">
<!--
function NavFor(us) {document.getElementById('I_subnav').innerHTML=us.ok?'<div class="sect"><h3><b><a href="/user/">'+us.user+'</a></b></h3><ul><li><a href="/forum/myposts.cgi">My topics</a></li></ul></div>':'';}onSession(NavFor);ready();
var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-521783-1']);
_gaq.push(['_trackPageview']);

(function() {
  var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
  ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
  var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();

//-->
</script>

</body>
</html>