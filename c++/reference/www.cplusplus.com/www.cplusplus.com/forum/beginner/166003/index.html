<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Class instantiation, which is the best w - C++ Forum</title>
<link rel="shortcut icon" type="image/x-icon" href="/favicon.ico">
<link rel="stylesheet" type="text/css" href="/v321/main.css">
<script src="/v321/main.js" type="text/javascript"></script>
<script type='text/javascript'>
var googletag = googletag || {};
googletag.cmd = googletag.cmd || [];
(function() {
var gads = document.createElement('script');
gads.async = true;
gads.type = 'text/javascript';
var useSSL = 'https:' == document.location.protocol;
gads.src = (useSSL ? 'https:' : 'http:') + 
'//www.googletagservices.com/tag/js/gpt.js';
var node = document.getElementsByTagName('script')[0];
node.parentNode.insertBefore(gads, node);
})();
</script>

<script type='text/javascript'>
googletag.cmd.push(function() {
googletag.defineSlot('/32882001/L', [728, 90], 'div-gpt-ad-1427191279638-0').addService(googletag.pubads());
googletag.enableServices();
});
</script>
</head>
<body>
<div id="I_top">
<div id="I_header">
<div id="I_logo"><a href="/" title="cplusplus.com"><div></div></a></div>
<div id="I_search">
<form id="search" action="/search.do" method="get">
Search: <input name="q" size="20" class="txt"> <input type="submit" value="Go" class="btn">
</form>
</div>
<div id="I_bar">
<ul>
<li><a href="/forum/">Forum</a></li>
<li><a href="/forum/beginner/">Beginners</a></li>
<li class="here">Class instantiation, which is the best w</li>
</ul>
</div>
<div id="I_user" class="C_LoginBox"><span title="ajax"></span></div>
</div>
</div>
<div id="I_mid">
<div id="I_wrap">
<div id="I_minheight"></div>
<div id="I_main">
<div class="C_support">
<div id='div-gpt-ad-1427191279638-0' style='width:728px; height:90px;'>
<script type='text/javascript'>
googletag.cmd.push(function() { googletag.display('div-gpt-ad-1427191279638-0'); });
</script>
</div>
</div>
<div id="I_content">
<h3><div class="C_ico default" title="post">&nbsp;</div> Class instantiation, which is the best way and why?</h3><span id="CH_edttl"></span><span class="rootdatPost" title="166003,root,0,-1,10,0"></span><div id="CH_PostList"><div class="C_forPost" id="msg836459"><span title="836459,154619,1023,24,1"></span>
<div class="box">
<div class="boxtop">
<div class="dwhen"><a href="#msg836459" title="Link to this post"><img src="/img/link.png" width="16" height="8"></a> <span id="CH_zTmabb61e57d2" title="Wed, 27 May 2015 15:10:53 +0000"></span><script type="text/javascript">WhenId('CH_zTmabb61e57d2');</script><noscript>May 27, 2015 at 3:10pm UTC</noscript></div>
<div class="dwho"><a href="/user/koko82/"><b>koko82</b> (24)</a></div>
</div>
<div class="dwhat" colspan="2" id="CH_i836459">
Hi All,<br>
<br>
Just learning about classes and trying to understand the different ways you can create an object. It looks like from code you can do this 3 ways, is this correct. One using a pointer, one using pointer new and other using standard. Which one is best to use and why? I know there is different types of memory but looking at the best way of doing this without problems. <br>
<br>
<div class="auto"><table class="snippet"><tr><td class="rownum"><pre><code>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br></code></pre></td>
<td class="source"><pre><code>    
    Level *test1;
    Level *test2 = <var>new</var> Level();
    Level test3;
    
    test1-&gt;a = 1;
    test2-&gt;a = 2;
    test3.a = 3;
</code></pre></td><td class="C_btnholder"></td></tr></table></div>

</div>
<div class="dhow">
<span class="dbtn" id="CH_btn836459"></span>

</div>
</div>
</div>
<div class="C_forPost" id="msg836461"><span title="836461,132874,1023,490,0"></span>
<div class="box">
<div class="boxtop">
<div class="dwhen"><a href="#msg836461" title="Link to this post"><img src="/img/link.png" width="16" height="8"></a> <span id="CH_zTm5134160ab0" title="Wed, 27 May 2015 15:17:16 +0000"></span><script type="text/javascript">WhenId('CH_zTm5134160ab0');</script><noscript>May 27, 2015 at 3:17pm UTC</noscript></div>
<div class="dwho"><a href="/user/shadowmouse/"><b>shadowmouse</b> (490)</a></div>
</div>
<div class="dwhat" colspan="2" id="CH_i836461">
This entirely depends on the context of what you're doing. Most small objects can be instantiated in way 3. Way 1 isn't complete, because it will almost always then be made to refer to a new or an existing object on the stack. I'd change way 2 into <br>
<div class="auto"><table class="snippet"><tr><td class="rownum"><pre><code>1<br>2<br></code></pre></td>
<td class="source"><pre><code>std::unique_ptr&lt;Level&gt; test2a (<var>new</var> Level); <cite>//way 2a</cite>
std::shared_ptr&lt;Level&gt; test2b (<var>new</var> Level); <cite>//way 2b </cite></code></pre></td><td class="C_btnholder"></td></tr></table></div>

</div>
<div class="dhow">
<span class="dbtn" id="CH_btn836461"></span>

</div>
</div>
</div>
<div class="C_forPost" id="msg836463"><span title="836463,16990,1023,3160,0"></span>
<div class="box">
<div class="boxtop">
<div class="dwhen"><a href="#msg836463" title="Link to this post"><img src="/img/link.png" width="16" height="8"></a> <span id="CH_zTmd0f0e8fc90" title="Wed, 27 May 2015 15:24:01 +0000"></span><script type="text/javascript">WhenId('CH_zTmd0f0e8fc90');</script><noscript>May 27, 2015 at 3:24pm UTC</noscript></div>
<div class="dwho"><a href="/user/MikeyBoy/"><b>MikeyBoy</b> (3160)</a></div>
</div>
<div class="dwhat" colspan="2" id="CH_i836463">
Line 6 is undefined behaviour (most likely, a crash), because you haven't initialised <b>test1</b> to actually point to anything.<br>
<br>
Your creation and use of test2 and test3 are fine.  It all depends what you want the lifetime of the object to be.  Do you need to create it on the heap, or can it be on the stack?
</div>
<div class="dhow">
<span class="dbtn" id="CH_btn836463"></span>

</div>
</div>
</div>
<div class="C_forPost" id="msg836468"><span title="836468,62677,1023,3984,0"></span>
<div class="box">
<div class="boxtop">
<div class="dwhen"><a href="#msg836468" title="Link to this post"><img src="/img/link.png" width="16" height="8"></a> <span id="CH_zTm386262e2ac" title="Wed, 27 May 2015 15:44:55 +0000"></span><script type="text/javascript">WhenId('CH_zTm386262e2ac');</script><noscript>May 27, 2015 at 3:44pm UTC</noscript></div>
<div class="dwho"><a href="/user/andywestken/"><b>andywestken</b> (3984)</a></div>
</div>
<div class="dwhat" colspan="2" id="CH_i836468">
@koko82<br>
<br>
Where did you pick up the idea you could use an uninitialized pointer?<br>
<br>
You could do this (i.e. create the object after defining the pointer test1:<br>
<br>
Edit: make code C++ Shell friendly.<br>
<br>
<div class="auto"><table class="snippet"><tr><td class="rownum"><pre><code>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26<br></code></pre></td>
<td class="source"><pre><code><dfn>#include &lt;iostream&gt;</dfn>

<var>class</var> Level {
<var>public</var>:
    Level() : a(0) { std::cout &lt;&lt; <kbd>"Level::Level() [value = "</kbd> &lt;&lt; a &lt;&lt; <kbd>"]\n"</kbd>; }
    ~Level() { std::cout &lt;&lt; <kbd>"Level::~Level() [value = "</kbd> &lt;&lt; a &lt;&lt; <kbd>"]\n"</kbd>; }
    <var>int</var> a;
};

<var>int</var> main() {
    Level *test1 = NULL; <cite>// good practice to initialize pointer variable to NULL</cite>
    Level *test2 = <var>new</var> Level; <cite>// no need for () in C++ when using default contructor</cite>
    Level test3;

    test1 = <var>new</var> Level(); <cite>// create new Level</cite>
    
    test1-&gt;a = 1;
    test2-&gt;a = 2;
    test3.a = 3;

    <var>delete</var> test1; <cite>// and remember to delete the objects we new-ed</cite>
    <var>delete</var> test2; <cite>// (the danger of forgetting to do this is why you</cite>
                  <cite>// should use unique_ptr or shared_ptr</cite>

    <var>return</var> 0;
}</code></pre></td><td class="C_btnholder"></td></tr></table></div>
<br>
<br>
Andy<br>

</div>
<div class="dhow">
<span class="sedited">Last edited on <span id="CH_zTm6a679819fd" title="Thu, 28 May 2015 13:39:43 +0000"></span><script type="text/javascript">WhenId('CH_zTm6a679819fd');</script><noscript>May 28, 2015 at 1:39pm UTC</noscript></span>
<span class="dbtn" id="CH_btn836468"></span>

</div>
</div>
</div>
<div class="C_forPost" id="msg836560"><span title="836560,166975,1023,810,0"></span>
<div class="box">
<div class="boxtop">
<div class="dwhen"><a href="#msg836560" title="Link to this post"><img src="/img/link.png" width="16" height="8"></a> <span id="CH_zTmd0e7b54e3e" title="Wed, 27 May 2015 22:23:22 +0000"></span><script type="text/javascript">WhenId('CH_zTmd0e7b54e3e');</script><noscript>May 27, 2015 at 10:23pm UTC</noscript></div>
<div class="dwho"><a href="/user/Gamer2015/"><b>Gamer2015</b> (810)</a></div>
</div>
<div class="dwhat" colspan="2" id="CH_i836560">
Definitely use the normal (3rd) way (if possible).<br>
This way you won't have to dynamically allocate memory which also makes it a little bit faster and you don't have to care about the scope of the Object because you know when it's going to die.<br>
<br>
<br>
If you have to use a pointer use one of the C++ memory-managing-classes std::shared_ptr or std::unique_ptr to prevent memory leaks
</div>
<div class="dhow">
<span class="sedited">Last edited on <span id="CH_zTm409a68b176" title="Wed, 27 May 2015 22:24:43 +0000"></span><script type="text/javascript">WhenId('CH_zTm409a68b176');</script><noscript>May 27, 2015 at 10:24pm UTC</noscript></span>
<span class="dbtn" id="CH_btn836560"></span>

</div>
</div>
</div>
<div class="C_forPost" id="msg836562"><span title="836562,154619,1023,24,0"></span>
<div class="box">
<div class="boxtop">
<div class="dwhen"><a href="#msg836562" title="Link to this post"><img src="/img/link.png" width="16" height="8"></a> <span id="CH_zTm2518003946" title="Wed, 27 May 2015 22:42:58 +0000"></span><script type="text/javascript">WhenId('CH_zTm2518003946');</script><noscript>May 27, 2015 at 10:42pm UTC</noscript></div>
<div class="dwho"><a href="/user/koko82/"><b>koko82</b> (24)</a></div>
</div>
<div class="dwhat" colspan="2" id="CH_i836562">
Thank you all for your responses most helpful. <br>
<br>
andywestken - I've seen some examples online<br>
<br>
Gamer2015 - if I need to use the 3rd way do I need to do anything with the deconstructer? Or will the default deconstructer suffice.<br>
<br>
Is this new way unique &amp; shared pointer, I am looking at some books doesn't seem to cover those?
</div>
<div class="dhow">
<span class="dbtn" id="CH_btn836562"></span>

</div>
</div>
</div>
<div class="C_forPost" id="msg836570"><span title="836570,11526,1023,1182,0"></span>
<div class="box">
<div class="boxtop">
<div class="dwhen"><a href="#msg836570" title="Link to this post"><img src="/img/link.png" width="16" height="8"></a> <span id="CH_zTm73b44b4427" title="Thu, 28 May 2015 00:28:49 +0000"></span><script type="text/javascript">WhenId('CH_zTm73b44b4427');</script><noscript>May 28, 2015 at 12:28am UTC</noscript></div>
<div class="dwho"><a href="/user/kempofighter/"><b>kempofighter</b> (1182)</a></div>
</div>
<div class="dwhat" colspan="2" id="CH_i836570">
<table class="quote"><tr><td class="qd"> if I need to use the 3rd way do I need to do anything with the deconstructer? Or will the default deconstructer suffice.</td></tr></table><br>
<br>
You mean the destructor.  There is no deconstructor.  Based on what you wrote, you have to delete the objects test1 and test 2.  If the level class also instantiates dynamic resources then yes its destructor might have to be coded to deal with that.  Using smart pointers and STL containers can reduce your responsibility as a programmer, but you always have to plan for dealing with dynamic memory somehow either by choosing a smart pointer or container, or by releasing the resource yourself.  <br>
<br>
Honestly, you will have to learn both ways because in any given program chances are there will be objects that are constructed in a variety of ways and you need to know how to deal with each and every circumstance.  Don't assume that you can get a way with always doing it one way or the other.
</div>
<div class="dhow">
<span class="dbtn" id="CH_btn836570"></span>

</div>
</div>
</div>
<div class="C_forPost" id="msg836573"><span title="836573,62677,1023,3984,0"></span>
<div class="box">
<div class="boxtop">
<div class="dwhen"><a href="#msg836573" title="Link to this post"><img src="/img/link.png" width="16" height="8"></a> <span id="CH_zTm98f6ddfe25" title="Thu, 28 May 2015 00:53:18 +0000"></span><script type="text/javascript">WhenId('CH_zTm98f6ddfe25');</script><noscript>May 28, 2015 at 12:53am UTC</noscript></div>
<div class="dwho"><a href="/user/andywestken/"><b>andywestken</b> (3984)</a></div>
</div>
<div class="dwhat" colspan="2" id="CH_i836573">
<table class="quote"><tr><td class="qd">which is the best way and why?</td></tr></table><br>
If you just need the object to live for the duration of a function call you should instantiate it on the stack (the 3rd way.) Then you don't have to worry about deleting it, or using a smart pointer.<br>
<br>
If you need the object to live beyond the lifetime of the function it was created in, then it needs to be allocated on the heap; preferably using some sort of smart pointer.<br>
<br>
Andy<br>

</div>
<div class="dhow">
<span class="sedited">Last edited on <span id="CH_zTm1b3bb0fb0a" title="Thu, 28 May 2015 01:03:36 +0000"></span><script type="text/javascript">WhenId('CH_zTm1b3bb0fb0a');</script><noscript>May 28, 2015 at 1:03am UTC</noscript></span>
<span class="dbtn" id="CH_btn836573"></span>

</div>
</div>
</div>
<div class="C_forPost" id="msg836605"><span title="836605,16990,1023,3160,0"></span>
<div class="box">
<div class="boxtop">
<div class="dwhen"><a href="#msg836605" title="Link to this post"><img src="/img/link.png" width="16" height="8"></a> <span id="CH_zTm21a4cf8178" title="Thu, 28 May 2015 09:30:05 +0000"></span><script type="text/javascript">WhenId('CH_zTm21a4cf8178');</script><noscript>May 28, 2015 at 9:30am UTC</noscript></div>
<div class="dwho"><a href="/user/MikeyBoy/"><b>MikeyBoy</b> (3160)</a></div>
</div>
<div class="dwhat" colspan="2" id="CH_i836605">
<table class="quote"><tr><td class="qd">I've seen some examples online</td></tr></table><br>
If your source of examples is telling you that you can de-reference an uninitialized pointer, then you need a better source if examples.<br>
<br>
Are you sure those examples didn't initialise the pointer to actually point to something, before dereferencing it?
</div>
<div class="dhow">
<span class="dbtn" id="CH_btn836605"></span>

</div>
</div>
</div>
<div class="C_forPost" id="msg836721"><span title="836721,154619,1023,24,0"></span>
<div class="box">
<div class="boxtop">
<div class="dwhen"><a href="#msg836721" title="Link to this post"><img src="/img/link.png" width="16" height="8"></a> <span id="CH_zTmc61634efb3" title="Thu, 28 May 2015 21:08:55 +0000"></span><script type="text/javascript">WhenId('CH_zTmc61634efb3');</script><noscript>May 28, 2015 at 9:08pm UTC</noscript></div>
<div class="dwho"><a href="/user/koko82/"><b>koko82</b> (24)</a></div>
</div>
<div class="dwhat" colspan="2" id="CH_i836721">
Thanks all for your help much appreciated. I will start to use the new smart pointer method as it seems you don't have to worry about deleting it from memory.
</div>
<div class="dhow">
<span class="dbtn" id="CH_btn836721"></span>

</div>
</div>
</div>
</div><div class="rootinsMore"></div><div class="rootbtnMore"></div><div class="rootinsNew"></div><div class="rootbtnNew"></div><div id="CH_insNew"></div><div id="CH_reply">Topic archived. No new replies allowed.</div><div id="CH_subscription"></div><div class="rootedtNew"></div><script type="text/javascript">new for_PostList(166003,1,154619,0,'CH_PostList','CH_subscription','CH_reply','CH_insNew','CH_edttl','/forum/thread.cgi','/forum/post.cgi','/forum/myposts.cgi',64,32,512,256,1024,16);</script></div>
<script type="text/javascript">
    google_ad_client = "ca-pub-1444228343479937";
    google_ad_slot = "9701143201";
    google_ad_width = 728;
    google_ad_height = 90;
</script>
<!-- leaderboard -->
<script type="text/javascript"
src="//pagead2.googlesyndication.com/pagead/show_ads.js">
</script></div>
<div id="I_nav">
<div class="sect root">
<h3><b><a href="/">C++</a></b></h3>
<ul>
<li class="folder info"><a href="/info/">Information</a></li>
<li class="folder doc"><a href="/doc/">Tutorials</a></li>
<li class="folder reference"><a href="/reference/">Reference</a></li>
<li class="folder articles"><a href="/articles/">Articles</a></li>
<li class="folder selected forum"><a href="/forum/">Forum</a></li>
</ul>
</div>
<div class="sect">
<h3><b><a href="/forum/">Forum</a></b></h3>
<ul>
<li class="selected"><a href="/forum/beginner/"><b>Beginners</b></a></li><li><a href="/forum/windows/"><b>Windows Programming</b></a></li><li><a href="/forum/unices/"><b>UNIX/Linux Programming</b></a></li><li><a href="/forum/general/"><b>General C++ Programming</b></a></li><li><a href="/forum/lounge/"><b>Lounge</b></a></li><li><a href="/forum/jobs/"><b>Jobs</b></a></li></ul>
</div>
<div id="I_subnav"></div>
<div class="C_ad234">
<script type="text/javascript"><!--
google_ad_client = "ca-pub-7688470879129516";
google_ad_slot = "7445514729";
google_ad_width = 234;
google_ad_height = 60;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</div></div>
<div id="I_midclear"></div>
</div>
</div>
<div id="I_bottom">
<div id="I_footer">
	<a href="/">Home page</a> | <a href="/privacy.do">Privacy policy</a><br>&copy; cplusplus.com, 2000-2016 - All rights reserved - <i>v3.1</i><br><a href="/contact.do?referrer=www.cplusplus.com%2Fforum%2Fbeginner%2F166003%2F">Spotted an error? contact us</a>
</div>
</div>

<script type="text/javascript">
<!--
function NavFor(us) {document.getElementById('I_subnav').innerHTML=us.ok?'<div class="sect"><h3><b><a href="/user/">'+us.user+'</a></b></h3><ul><li><a href="/forum/myposts.cgi">My topics</a></li></ul></div>':'';}onSession(NavFor);ready();
var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-521783-1']);
_gaq.push(['_trackPageview']);

(function() {
  var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
  ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
  var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();

//-->
</script>

</body>
</html>